import{_ as b,I as A,s as $,aw as D,r as l,o as i,d as u,b as s,i as c,w as r,t as I,c as k,k as g,m as v,h as C,F as E,e as S,f as F,v as Q,D as L,p as y,q as B}from"./index-d9377e3a.js";import{C as N}from"./CustomIcons-60888788.js";import{L as V}from"./ListManager-d2a1afc7.js";import{L as T}from"./ListViewer-af42e401.js";import"./Dropdown-e0c50cd3.js";import"./use-tracked-pointer-4b3ac621.js";import"./use-resolve-button-type-390b11ae.js";import"./listFilters-8ea4c2e9.js";import"./Autocomplete-c752a27e.js";import"./use-controllable-93c8440b.js";import"./CustomSwitch-323f8131.js";import"./ErrorMessage-e4ff6432.js";const M={name:"AgentListItem",props:["agent","selected"],components:{Input:A,FeatherIcon:$,Badge:D}},P={key:0,role:"button",class:"flex items-center text-base"},R={class:"w-[37px] h-[14px] flex items-center"},W={class:"sm:w-5/12 truncate pr-10"},H={class:"sm:w-5/12 truncate pr-10"},j={class:"sm:w-2/12 truncate"},z={class:"w-full flex flex-row-reverse"};function q(t,e,n,a,p,d){const h=l("Input"),m=l("Badge"),_=l("router-link");return i(),u("div",{class:C(["block select-none rounded-[6px] py-[7px] px-[11px]",n.selected?"bg-blue-50 hover:bg-blue-100":"hover:bg-gray-50"])},[n.agent?(i(),u("div",P,[s("div",R,[c(h,{type:"checkbox",onClick:e[0]||(e[0]=x=>t.$emit("toggleSelect")),checked:n.selected,role:"button"},null,8,["checked"])]),c(_,{to:`/frappedesk/settings/agents/${n.agent.name}`,class:"w-full group flex items-center"},{default:r(()=>[s("div",W,I(n.agent.full_name),1),s("div",H,I(n.agent.email),1),s("div",j,[s("div",z,[n.agent.send_welcome_email?(i(),k(m,{key:0,color:"yellow"},{default:r(()=>[g(" Pending ")]),_:1})):v("",!0)])])]),_:1},8,["to"])])):v("",!0)],2)}const O=b(M,[["render",q]]),U={name:"AgentList",props:["manager"],components:{AgentListItem:O,CustomIcons:N,Input:A},setup(){return{viewportWidth:Q("viewportWidth")}}},Y={class:"bg-[#F7F7F7] group flex items-center text-base font-medium text-gray-500 py-[10px] px-[11px] rounded-[6px] select-none"},G={class:"w-[37px] h-[14px]"},J=s("div",{class:"flex flex-row items-center group w-full"},[s("div",{class:"sm:w-5/12"},"Name"),s("div",{class:"sm:w-5/12"},"Email"),s("div",{class:"sm:w-2/12"})],-1),K={key:0},X={key:0},Z={key:1},ee={class:"grid place-content-center h-48 w-full"},te=s("div",{class:"text-gray-500 mb-2"}," No agents found ",-1),ne={class:"pb-2"};function se(t,e,n,a,p,d){const h=l("Input"),m=l("AgentListItem"),_=l("CustomIcons"),x=l("Button");return i(),u("div",null,[s("div",Y,[s("div",G,[c(h,{type:"checkbox",onClick:e[0]||(e[0]=o=>n.manager.selectAll()),checked:n.manager.allItemsSelected,role:"button"},null,8,["checked"])]),J]),s("div",{id:"rows",class:"flex flex-col space-y-2 overflow-auto",style:F({height:a.viewportWidth>768?"calc(100vh - 120px)":null})},[n.manager.loading?v("",!0):(i(),u("div",K,[n.manager.list.length>0?(i(),u("div",X,[(i(!0),u(E,null,S(n.manager.list,(o,w)=>(i(),u("div",{key:o.name},[c(m,{class:C(w==0?"mt-[9px] mb-[2px]":"my-[2px]"),agent:o,onToggleSelect:f=>n.manager.select(o),selected:n.manager.itemSelected(o)},null,8,["class","agent","onToggleSelect","selected"])]))),128))])):(i(),u("div",Z,[s("div",ee,[s("div",null,[c(_,{name:"empty-list",class:"h-12 w-12 mx-auto mb-2"}),te])])]))])),s("div",ne,[n.manager.hasNextPage?(i(),k(x,{key:0,onClick:e[1]||(e[1]=o=>n.manager.nextPage())},{default:r(()=>[g(" Load More ")]),_:1})):v("",!0)])],4)])}const oe=b(U,[["render",se]]),ae={name:"AddNewAgentsDialog",props:["show"],components:{Dialog:L,Input:A,FeatherIcon:$},setup(){const t=y(""),e=y([]),n=y(!1);return{searchInput:t,inviteQueue:e,currentInputIsValidEmail:n}},methods:{testEmailRegex(t){return/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/.test(t)},onSearchInputChange(t){if(t=t.replaceAll(" ",""),t==""){document.getElementById("searchInput").value="";return}const e=t,n=t.split(",");let a=!1;this.currentInputIsValidEmail=!1,n.forEach(p=>{this.testEmailRegex(p)&&(n.length>1?(this.addToInviteQueue(p),a=!0):e.includes(",")?(this.addToInviteQueue(p),a=!0):this.currentInputIsValidEmail=!0)}),a&&this.clearSearchInput()},addToInviteQueue(t){this.inviteQueue=[...new Set([...this.inviteQueue,t])]},removeEmailFromQueue(t){this.inviteQueue=this.inviteQueue.filter(e=>e!==t)},removeAllEmailFromQueue(){this.inviteQueue=[]},clearSearchInput(){this.currentInputIsValidEmail=!1,this.searchInput="";const t=document.getElementById("searchInput");t.value="",t.focus()},close(){this.searchInput="",this.inviteQueue=[],this.$emit("close")},sentInvites(){this.$resources.sentInvites.submit({emails:this.inviteQueue})}},resources:{sentInvites(){return{url:"frappedesk.api.agent.sent_invites",onSuccess:t=>{this.currentInputIsValidEmail=!1,this.searchInput="",this.inviteQueue=[],this.$clearToasts(),this.$toast({title:"Invites Sent Successfully!",icon:"check",iconClasses:"text-green-500"}),this.close()},onError:t=>{t.exc_type=="PaywallReachedError"?this.$toast({title:"Paywall Reached!",text:"You have reached the maximum number of agents you can add. Please upgrade your plan to add more agents.",icon:"x",iconClasses:"text-red-500"}):this.$toast({title:"Error Sending Invites!",icon:"x",iconClasses:"text-red-500"})}}}}},ie={class:"space-y-3"},le={class:"bg-gray-100 min-h-[100px] max-h-[300px] overflow-y-auto px-2 rounded border flex flex-col"},re={key:0,class:"flex flex-wrap gap-2 py-2"},ce=["title"],ue={class:"text-base ml-2"},de=["onClick"],me={class:"grow"};function ge(t,e,n,a,p,d){const h=l("Input"),m=l("Button"),_=l("FeatherIcon"),x=l("Dialog");return i(),u("div",null,[c(x,{options:{title:"Add Agents"},show:n.show,onClose:e[7]||(e[7]=o=>d.close())},{"body-content":r(()=>[s("div",ie,[s("form",{onSubmit:e[3]||(e[3]=B((...o)=>t.onSubmit&&t.onSubmit(...o),["prevent"])),class:"flex flex-row space-x-2 items-center"},[c(h,{id:"searchInput",class:"w-full",type:"text",modelValue:a.searchInput,"onUpdate:modelValue":e[0]||(e[0]=o=>a.searchInput=o),placeholder:"Type emails",onInput:e[1]||(e[1]=o=>d.onSearchInputChange(o))},null,8,["modelValue"]),a.currentInputIsValidEmail?(i(),k(m,{key:0,appearance:"primary",type:"submit",icon:"arrow-down",onClick:e[2]||(e[2]=()=>{d.addToInviteQueue(a.searchInput),d.clearSearchInput()})},{default:r(()=>[g(" Add ")]),_:1})):v("",!0)],32),s("div",le,[a.inviteQueue.length?(i(),u("ul",re,[(i(!0),u(E,null,S(a.inviteQueue.slice().reverse(),o=>(i(),u("li",{class:"flex items-center p-1 space-x-2 bg-white shadow rounded",key:o,title:o},[s("span",ue,I(o),1),s("button",{class:"grid w-4 h-4 text-gray-700 rounded hover:bg-gray-300 place-items-center",onClick:w=>d.removeEmailFromQueue(o)},[c(_,{class:"w-3",name:"x"})],8,de)],8,ce))),128))])):v("",!0)])])]),actions:r(()=>[c(m,{disabled:a.inviteQueue.length==0,appearance:"primary",onClick:e[4]||(e[4]=o=>d.sentInvites()),loading:t.$resources.sentInvites.loading},{default:r(()=>[g("Send Invites")]),_:1},8,["disabled","loading"]),c(m,{appearance:"secondary",onClick:e[5]||(e[5]=o=>d.close())},{default:r(()=>[g("Cancel")]),_:1}),s("div",me,[a.inviteQueue.length>1?(i(),k(m,{key:0,onClick:e[6]||(e[6]=o=>d.removeAllEmailFromQueue())},{default:r(()=>[g(" Clear All ")]),_:1})):v("",!0)])]),_:1},8,["show"])])}const pe=b(ae,[["render",ge]]),he={name:"Agents",components:{AgentList:oe,ListManager:V,AddNewAgentsDialog:pe,ListViewer:T},setup(){const t=Q("viewportWidth"),e=y(!1);return{viewportWidth:t,showNewAgentDialog:e}},resources:{deleteAgent(){return{url:"frappe.client.delete"}},bulk_delete_agents(){return{url:"frappedesk.api.doc.delete_items",onSuccess:()=>{this.$router.go()},onError:t=>{this.$refs.listManager.manager.reload(),this.$toast({title:"Error while deleting agents",text:t,icon:"check",iconClasses:"text-red-500"})}}}}},_e={class:"flex flex-col px-4"},fe={class:"text-[13px] font-inter text-gray-600"},ve={class:"flex flex-row space-x-2"};function xe(t,e,n,a,p,d){const h=l("router-link"),m=l("Button"),_=l("ListViewer"),x=l("ListManager"),o=l("AddNewAgentsDialog");return i(),u("div",_e,[c(x,{ref:"listManager",options:{cache:["Agents","Desk"],doctype:"HD Agent",urlQueryFilters:!0,saveFiltersLocally:!0,fields:["user","agent_name"],limit:20}},{body:r(({manager:w})=>[c(_,{options:{name:"HD Agent",base:"12",listTitle:"Agents",filterBox:!0,presetFilters:!0,fields:{agent_name:{label:"Name",width:"4"},user:{label:"Email",width:"2"}}},class:"text-base h-[calc(100vh-9.5rem)] pt-4",onAddItem:e[0]||(e[0]=()=>{a.showNewAgentDialog=!0})},{"field-agent_name":r(({row:f})=>[c(h,{to:{path:`/frappedesk/settings/agents/${f.user}`},class:"text-[13px] text-gray-600 font-inter hover:text-gray-900"},{default:r(()=>[g(I(`${f.agent_name}`),1)]),_:2},1032,["to"])]),"field-user":r(({row:f})=>[s("div",fe,I(`${f.user}`),1)]),"bulk-actions":r(({selectedItems:f})=>[s("div",ve,[c(m,{onClick:()=>{t.$resources.deleteAgent.submit({doctype:"HD Agent",name:Object.keys(f)}).then(()=>{w.unselect(),w.reload()})}},{default:r(()=>[g("Delete")]),_:2},1032,["onClick"])])]),_:2},1024)]),_:1},512),c(o,{show:a.showNewAgentDialog,onClose:e[1]||(e[1]=()=>{a.showNewAgentDialog=!1,t.$refs.listManager.manager.reload(),t.$router.go()})},null,8,["show"])])}const Fe=b(he,[["render",xe]]);export{Fe as default};
