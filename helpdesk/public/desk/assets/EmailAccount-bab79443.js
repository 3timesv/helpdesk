import{C as A}from"./CustomSwitch-323f8131.js";import{I as k}from"./Images-cb3ddf70.js";import{_ as I,I as y,s as N,p as u,d as n,b as s,t as f,i as o,c as v,m as r,F as O,e as C,w as b,k as _,r as d,o as i,h as V}from"./index-d9377e3a.js";import{L as S}from"./LoadingText-f736f9e5.js";import"./use-resolve-button-type-390b11ae.js";import"./use-controllable-93c8440b.js";const D={name:"EmailAccount",props:["emailAccountId"],components:{Input:y,CustomSwitch:A,FeatherIcon:N,Images:k,LoadingText:S},setup(){const t=u([{title:"GMail",image:"gmail",name:"GMail",selected:!0},{title:"Outlook",image:"outlook",name:"Outlook.com"},{title:"Yahoo Mail",image:"yahoo",name:"Yahoo Mail"},{title:"Others",name:"Others"}]),a={GMail:{email_server:"imap.gmail.com",use_ssl:1,smtp_server:"smtp.gmail.com"},"Outlook.com":{email_server:"imap-mail.outlook.com",use_ssl:1,smtp_server:"smtp-mail.outlook.com"},Sendgrid:{smtp_server:"smtp.sendgrid.net",smtp_port:587},SparkPost:{smtp_server:"smtp.sparkpostmail.com"},"Yahoo Mail":{email_server:"imap.mail.yahoo.com",use_ssl:1,smtp_server:"smtp.mail.yahoo.com",smtp_port:587},"Yandex.Mail":{email_server:"imap.yandex.com",use_ssl:1,smtp_server:"smtp.yandex.com",smtp_port:587}},h=u(!1),e=u(!1),x=u(""),m=u({service:t.value[0].name,emailAccountName:"",emailId:"",password:"",enableIncoming:!0,enableOutgoing:!0,defaultIncoming:!1,defaultOutgoing:!1}),c=u("");return{services:t,emailDefaults:a,isNew:h,editingName:e,values:m,tempEmailAccountName:c,initialPassword:x,errors:{"Error: frappe.client.set_value InvalidEmailCredentials":"Invalid Email ID or Password.","Error: frappe.client.insert ValidationError":"Validation Error.","Error: frappe.client.insert InvalidEmailCredentials":"Invalid Email ID or Password."}}},mounted(){this.$event.emit("set-selected-setting","Email Accounts"),this.$event.emit("show-top-panel-actions-settings","Email Account"),this.isNew=this.$route.name==="NewEmailAccount",this.editingName=this.isNew,this.isNew?this.setDefaultValues():this.$resources.getEmailAccount.fetch()},methods:{selectService(t){this.services.forEach(a=>{a.selected=!1}),t.selected=!0,this.values.service=t.name},setDefaultValues(){this.values={emailAccountName:"",emailId:"",password:"",service:"GMail",enableIncoming:!0,enableOutgoing:!0,defaultIncoming:!1,defaultOutgoing:!1}},create(){this.validateInputs()&&this.$resources.createNewEmailAccount.submit({doc:{doctype:"Email Account",email_account_name:this.tempEmailAccountName,email_id:this.values.emailId,password:this.values.password,enable_incoming:this.values.enableIncoming,enable_outgoing:this.values.enableOutgoing,default_incoming:this.values.defaultIncoming,default_outgoing:this.values.defaultOutgoing,email_sync_option:"UNSEEN",initial_sync_count:100,imap_folder:[{append_to:"HD Ticket",folder_name:"INBOX"}],create_contact:!0,track_email_status:!0,service:this.values.service,use_tls:1,use_imap:1,smtp_port:587,...this.emailDefaults[this.values.service]}})},save(){this.validateInputs()&&this.$resources.updateEmailAccount.submit({doctype:"Email Account",name:this.values.emailAccountName,fieldname:{email_account_name:this.tempEmailAccountName,email_id:this.values.emailId,password:this.values.password,enable_incoming:this.values.enableIncoming,enable_outgoing:this.values.enableOutgoing,default_incoming:this.values.defaultIncoming,default_outgoing:this.values.defaultOutgoing}})},cancel(){this.$router.go()},rename(){return this.$resources.renameEmailAccount.submit({doctype:"Email Account",old_name:this.values.emailAccountName,new_name:this.tempEmailAccountName})},validateInputs(){return!0}},resources:{checkDefaultOutgoingEmailAccount(){return{url:"frappe.client.get_count",params:{doctype:"Email Account",filters:[["use_imap","=",1],["IMAP Folder","append_to","=","HD Ticket"],["default_outgoing","=",1]]},onSuccess:t=>{t==0&&(this.values.enableOutgoing=!0,this.values.defaultOutgoing=!0)},auto:!0}},getEmailAccount(){return{url:"frappe.client.get",params:{doctype:"Email Account",name:this.emailAccountId,fields:["*"]},onSuccess:t=>{this.tempEmailAccountName=t.email_account_name,this.values={emailAccountName:t.email_account_name,emailId:t.email_id,password:t.password,service:t.service,enableIncoming:!!t.enable_incoming,enableOutgoing:!!t.enable_outgoing,defaultIncoming:!!t.default_incoming,defaultOutgoing:!!t.default_outgoing}},onError:t=>{this.$toast({title:"Error getting Email Account.",text:this.errors[t]||t,icon:"x",iconClasses:"text-red-500"})}}},createNewEmailAccount(){return{url:"frappe.client.insert",onSuccess:()=>{this.$toast({title:"Email Account Created!!",icon:"check",iconClasses:"text-green-500"}),this.$clearToasts(),this.$router.push({name:"Emails"})},onError:t=>{this.$toast({title:"Error creating new Email Account.",text:this.errors[t]||t,icon:"x",iconClasses:"text-red-500"})}}},updateEmailAccount(){return{url:"frappe.client.set_value",onSuccess:()=>{this.values.emailAccountName!=this.tempEmailAccountName?this.$resources.renameEmailAccount.submit({doctype:"Email Account",old_name:this.values.emailAccountName,new_name:this.tempEmailAccountName}):this.$toast({title:"Email Account Updated.",icon:"check",iconClasses:"text-green-500"})},onError:t=>{this.$toast({title:"Error updating Email Account.",text:this.errors[t]||t,icon:"x",iconClasses:"text-red-500"})}}},renameEmailAccount(){return{url:"frappe.client.rename_doc",onSuccess:t=>{window.location.href=`/frappedesk/settings/emails/${t}`},onError:t=>{this.$toast({title:"Error renaming Email Account.",text:this.errors[t]||t,icon:"x",iconClasses:"text-red-500"})}}}}},M={class:"p-5 overflow-auto h-full"},P={class:"flex flex-row mb-4 w-full"},B={class:"grow flex flex-col space-y-6"},U={class:"flex flex-row w-full space-x-10"},F={key:0,class:"flex space-x-2 items-center cursor-pointer"},G={class:"font-semibold"},T={key:1,class:"flex space-x-2 max-w-sm items-center w-full"},Y=s("div",{class:"sm:w-6/12"},null,-1),L=s("div",{class:"flex space-x-2 items-center"},[s("div",{class:"text-base font-semibold"}," Email Setup ")],-1),z={class:"pt-4 space-y-5 w-full"},H=s("span",{class:"block mb-2 text-sm leading-4 text-gray-700"}," Service ",-1),R={class:"flex flex-wrap text-[11px] text-gray-700 mx-[-4px]"},X=["onClick"],j={class:"flex flex-col space-y-3"},q={key:0,class:"max-w-sm bg-blue-50 border-blue-500 rounded p-3 border-2 text-base text-gray-700 flex flex-row space-x-4 items-center"},J=s("p",null,[_(" GMail will only work if you enable 2-step authentication and use app-specific password. "),s("a",{href:"https://docs.erpnext.com/docs/v13/user/manual/en/setting-up/email/email_account_setup_with_gmail",target:"_blank",class:"text-blue-500 hover:underline"},"Read the step by step guide here.")],-1),K={class:"max-w-sm bg-blue-50 border-blue-500 rounded p-3 border-2 text-base text-gray-700 flex flex-row space-x-4 items-center"},Q=s("p",null," Only unseen emails will be synchronized. ",-1),W=s("div",{class:"flex space-x-2 items-center"},[s("div",{class:"text-base font-semibold"}," Properties ")],-1),Z={class:"py-4 w-full text-gray-900 text-base flex flex-col space-y-5"},$={class:"flex flex-col space-y-2"},ee={class:"flex flex-row w-full mb-2 space-x-10"},te={class:"flex flex-row space-x-5"},se=s("div",null,"Incoming",-1),ae={class:"flex flex-row space-x-5"},le={key:0},oe={class:"flex flex-row w-full space-x-10"},ie={class:"flex flex-row space-x-5"},ne=s("div",null,"Outgoing",-1),ce={class:"flex flex-row space-x-5"},re={key:0},me={key:0,class:"max-w-sm bg-yellow-50 border-yellow-500 rounded p-3 border-2 text-base text-gray-700 flex flex-row space-x-4 items-center"},ue=s("p",null," There should be an email account which is marked as default outgoing. ",-1),de={class:"flex flex-row space-x-2 items-center"};function ge(t,a,h,e,x,m){const c=d("FeatherIcon"),g=d("Input"),E=d("Images"),p=d("CustomSwitch"),w=d("Button");return i(),n("div",M,[s("form",null,[s("div",P,[s("div",B,[s("div",U,[s("div",{onClick:a[2]||(a[2]=()=>{e.editingName=!0,e.isNew||(e.tempEmailAccountName=e.values.emailAccountName)}),class:"sm:w-6/12"},[e.editingName?(i(),n("div",T,[o(g,{label:"Email Account name",class:"grow",id:"emailAccountNameInput",modelValue:e.tempEmailAccountName,"onUpdate:modelValue":a[0]||(a[0]=l=>e.tempEmailAccountName=l),type:"text",placeholder:"Email Account Name"},null,8,["modelValue"]),e.isNew?r("",!0):(i(),v(c,{key:0,class:"w-4 h-4 cursor-pointer",name:"x",onClick:a[1]||(a[1]=()=>{e.editingName=!1,e.tempEmailAccountName=e.values.emailAccountName})}))])):(i(),n("div",F,[s("div",G,f(e.values.emailAccountName),1),o(c,{class:"w-3 h-3",name:"edit"})]))]),Y]),s("div",null,[L,s("div",z,[s("div",null,[H,s("div",R,[(i(!0),n(O,null,C(e.services,l=>(i(),n("div",{key:l.title,role:"button",class:V(["h-[90px] w-[90px] m-1 p-[8px] items-center border hover:shadow-sm rounded flex flex-col space-y-2",l.selected?"border-2 border-blue-500 bg-blue-50":"bg-white"]),onClick:pe=>m.selectService(l)},[o(E,{name:l.image,class:"h-11 w-11"},null,8,["name"]),s("div",null,f(l.title),1)],10,X))),128))])]),s("div",j,[e.values.service=="GMail"?(i(),n("div",q,[o(c,{name:"info",class:"shrink-0 w-6 h-6 stroke-blue-500 stroke-2"}),J])):r("",!0),s("div",K,[o(c,{name:"info",class:"shrink-0 w-6 h-6 stroke-blue-500 stroke-2"}),Q])]),o(g,{class:"grow max-w-sm",label:"Email Id",type:"text",value:e.values.emailId,placeholder:"Email Id",onChange:a[3]||(a[3]=l=>e.values.emailId=l)},null,8,["value"]),o(g,{onClick:a[4]||(a[4]=()=>{e.isNew||(e.initialPassword===e.values.password&&(e.values.password=""),e.initialPassword===""&&(e.initialPassword=e.values.password,e.values.password=""))}),class:"grow max-w-sm",label:"Password",type:"password",value:e.values.password,placeholder:"Password",onChange:a[5]||(a[5]=l=>e.values.password=l)},null,8,["value"])])]),s("div",null,[W,s("div",Z,[s("div",$,[s("div",ee,[s("div",te,[se,o(p,{modelValue:e.values.enableIncoming,"onUpdate:modelValue":a[6]||(a[6]=l=>e.values.enableIncoming=l)},null,8,["modelValue"])]),s("div",ae,[e.values.enableIncoming?(i(),n("div",le," Default ")):r("",!0),e.values.enableIncoming?(i(),v(p,{key:1,modelValue:e.values.defaultIncoming,"onUpdate:modelValue":a[7]||(a[7]=l=>e.values.defaultIncoming=l)},null,8,["modelValue"])):r("",!0)])]),s("div",oe,[s("div",ie,[ne,o(p,{modelValue:e.values.enableOutgoing,"onUpdate:modelValue":a[8]||(a[8]=l=>e.values.enableOutgoing=l)},null,8,["modelValue"])]),s("div",ce,[e.values.enableOutgoing?(i(),n("div",re," Default ")):r("",!0),e.values.enableOutgoing?(i(),v(p,{key:1,modelValue:e.values.defaultOutgoing,"onUpdate:modelValue":a[9]||(a[9]=l=>e.values.defaultOutgoing=l)},null,8,["modelValue"])):r("",!0)])])]),!e.values.defaultOutgoing&&!e.values.enableOutgoing&&!t.$resources.checkDefaultOutgoingEmailAccount.loading&&t.$resources.checkDefaultOutgoingEmailAccount.data==0?(i(),n("div",me,[o(c,{name:"alert-triangle",class:"shrink-0 w-6 h-6 stroke-yellow-500 stroke-2"}),ue])):r("",!0)])])]),s("div",null,[s("div",de,[o(w,{appearance:"secondary",onClick:a[10]||(a[10]=l=>m.cancel())},{default:b(()=>[_("Cancel")]),_:1}),o(w,{appearance:"primary",onClick:a[11]||(a[11]=()=>{e.isNew?m.create():m.save()}),loading:e.isNew?t.$resources.createNewEmailAccount.loading:t.$resources.updateEmailAccount.loading||t.$resources.renameEmailAccount.loading},{default:b(()=>[_(f(` ${e.isNew?"Create":"Save"}`),1)]),_:1},8,["loading"])])])])])])}const be=I(D,[["render",ge]]);export{be as default};
