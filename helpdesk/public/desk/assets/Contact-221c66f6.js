import{_ as b,s as V,I as L,p as A,o as p,d as g,b as o,t as k,i as s,w as a,k as h,c as N,m as $,r as i,T as j,u as U}from"./index-d9377e3a.js";import{E}from"./ErrorMessage-e4ff6432.js";import{F as D}from"./FileUploader-997fc331.js";import{U as F}from"./UserAvatar-3798c645.js";import{A as M}from"./Autocomplete-c752a27e.js";import{D as P}from"./Dropdown-e0c50cd3.js";import{L as B}from"./ListManager-d2a1afc7.js";import{L as O}from"./ListViewer-af42e401.js";import{A as R}from"./Avatar-166461f8.js";import{T as H,a as z,S as q}from"./Subject-97b60af0.js";import{T as J}from"./TicketStatus-1f4b539e.js";import"./CustomIcons-60888788.js";import"./use-tracked-pointer-4b3ac621.js";import"./use-resolve-button-type-390b11ae.js";import"./use-controllable-93c8440b.js";import"./listFilters-8ea4c2e9.js";import"./CustomSwitch-323f8131.js";const G={name:"ContactInfo",props:["contactId"],components:{FeatherIcon:V,Input:L,FileUploader:D,UserAvatar:F,Autocomplete:M,ErrorMessage:E},setup(){const e=A(!1),t=A({fullName:"",email:"",phone:"",customer:"",profilePicture:""}),u=A({fullName:"",email:"",phone:"",customer:""});return{editingName:e,newContactValues:t,contactInputErrors:u}},computed:{contact(){const e=this.$resources.contact.doc;return e&&(this.newContactValues.fullName=(e.first_name||"")+" "+(e.last_name||""),e.email_ids.length>0&&(this.newContactValues.email=e.email_ids[0].email_id),e.phone_nos.length>0&&(this.newContactValues.phone=e.phone_nos[0].phone),e.links.length>0&&(this.newContactValues.customer=e.links[0].link_name),this.newContactValues.profilePicture=e.image||""),e}},resources:{contact(){return{type:"document",doctype:"Contact",name:this.contactId,setValue:{onSuccess:e=>{this.$toast({title:"Contact Updated.",icon:"check",iconClasses:"text-green-500"}),this.$router.go()}}}}},methods:{setContactImage(e){this.$resources.contact.setValue.submit({image:e})},validate(){return this.newContactValues.fullName===""?(this.contactInputErrors.fullName="Name is required.",!1):!0},save(){const e=this.newContactValues,t=[];e.customer&&t.push({link_doctype:"HD Customer",link_name:e.customer});let u="",n="";e.fullName.split(" ").length>1?(u=e.fullName.split(" ")[0],n=e.fullName.substring(u.length+1)):(u=e.fullName,n=""),this.$resources.contact.setValue.submit({first_name:u,last_name:n,email_ids:e.email?[{email_id:e.email}]:[],phone_nos:e.phone?[{phone:e.phone}]:[],links:t})},cancel(){this.$router.go()}}},K={class:"min-w-[304px] px-[24px] py-[10px]"},Q={key:0,class:"form w-full flex flex-col"},W={key:0,class:"flex space-x-2 items-center cursor-pointer"},X={class:"font-semibold"},Y={key:1,class:"flex space-x-2"},Z={class:"flex flex-col space-y-[24px]"},ee=o("span",{class:"block mb-2 text-sm leading-4 text-gray-700"},"Profile Picture",-1),te={class:"flex flex-row space-x-[8px] items-center"},se={class:"flex items-center space-x-2"},ne={class:"w-full space-y-1"},oe=o("div",null,[o("span",{class:"block mb-2 text-sm leading-4 text-gray-700"}," Customer ")],-1),ae={class:"w-full flex flex-row"},ie={class:"grow flex flex-row-reverse"};function le(e,t,u,n,w,c){const d=i("FeatherIcon"),m=i("Input"),x=i("ErrorMessage"),y=i("UserAvatar"),f=i("Button"),T=i("FileUploader"),C=i("Autocomplete");return p(),g("div",K,[c.contact?(p(),g("div",Q,[o("div",{class:"float-left mb-[16px]",onClick:t[2]||(t[2]=()=>{n.editingName=!0})},[n.editingName?(p(),g("div",Y,[o("div",null,[s(m,{id:"contactNameInput",value:n.newContactValues.fullName,onChange:t[0]||(t[0]=r=>{n.newContactValues.fullName=r}),type:"text"},null,8,["value"]),s(x,{message:n.contactInputErrors.fullName},null,8,["message"])]),s(d,{class:"w-4 h-4",role:"button",name:"x",onClick:t[1]||(t[1]=()=>{n.editingName=!1,n.newContactValues.fullName=(c.contact.first_name||"")+" "+(c.contact.last_name||"")})})])):(p(),g("div",W,[o("div",X,k(`${c.contact.first_name||""} ${c.contact.last_name||""}`),1),s(d,{class:"w-3 h-3",name:"edit"})]))]),o("div",Z,[o("div",null,[ee,o("div",te,[s(T,{onSuccess:t[4]||(t[4]=r=>c.setContactImage(r.file_url))},{default:a(({file:r,progress:_,uploading:I,openFileSelector:v})=>[o("div",se,[s(y,{size:"lg",fullName:n.newContactValues?.fullName,userImage:n.newContactValues?.profilePicture},null,8,["fullName","userImage"]),s(f,{onClick:v},{default:a(()=>[h(k(I?`Uploading ${_}%`:"Upload Image"),1)]),_:2},1032,["onClick"]),n.newContactValues?.profilePicture?(p(),N(f,{key:0,onClick:t[3]||(t[3]=l=>c.setContactImage(null))},{default:a(()=>[h(" Remove ")]),_:1})):$("",!0)])]),_:1})])]),s(m,{class:"grow",label:"E-mail",type:"text",value:n.newContactValues.email,onChange:t[5]||(t[5]=r=>n.newContactValues.email=r)},null,8,["value"]),s(m,{class:"grow",label:"Phone",type:"text",value:n.newContactValues.phone,onChange:t[6]||(t[6]=r=>n.newContactValues.phone=r)},null,8,["value"]),o("div",ne,[oe,s(C,{value:n.newContactValues.customer,onChange:t[7]||(t[7]=r=>{n.newContactValues.customer=r.value}),resourceOptions:{url:"frappedesk.extends.client.get_list",inputMap:r=>({doctype:"HD Customer",pluck:"name",filters:[["name","like",`%${r}%`]]}),responseMap:r=>r.map(_=>({label:_.name,value:_.name}))}},null,8,["value","resourceOptions"]),s(x,{message:n.contactInputErrors.customer},null,8,["message"])]),o("div",ae,[o("div",null,[s(f,{onClick:t[8]||(t[8]=r=>c.cancel())},{default:a(()=>[h("Cancel")]),_:1})]),o("div",ie,[s(f,{loading:this.$resources.contact.setValue.loading,appearance:"primary",onClick:t[9]||(t[9]=()=>{c.validate()&&c.save()})},{default:a(()=>[h("Save")]),_:1},8,["loading"])])])])])):$("",!0)])}const ce=b(G,[["render",le]]),re={name:"AgentAvatar",components:{Avatar:R},props:{agent:{type:String,default:""}},computed:{user(){return this.$resources?.user?.doc||{}},image(){return this.user.user_image},name(){return this.user.full_name}},resources:{user(){if(this.agent)return{type:"document",doctype:"User",name:this.agent,cache:["User",this.agent]}}}};function ue(e,t,u,n,w,c){const d=i("Avatar"),m=i("Tooltip");return p(),N(m,{text:c.name},{default:a(()=>[s(d,{size:"sm","image-u-r-l":c.image,label:c.name},null,8,["image-u-r-l","label"])]),_:1},8,["text"])}const me=b(re,[["render",ue]]),de={name:"ContactRelatedInfo",props:["contact"],components:{ListManager:B,ListViewer:O,AgentAvatar:me,FeatherIcon:V,Dropdown:P,Tooltip:j,TicketType:H,TicketStatus:J,TicketPriority:z,Subject:q},inject:["agents"],setup(){return{authStore:U()}},methods:{agentsAsDropdownOptions(){let e=[];if(this.agents){this.agents.forEach(u=>{e.push({label:u.agent_name,handler:()=>{this.$resources.bulkAssignTicketToAgent.submit({ticket_ids:Object.keys(this.$refs.miniTicketList.manager.selectedItems),agent_id:u.name})}})});let t=[];return this.authStore.isAgent&&t.push({group:"Myself",hideLabel:!0,items:[{label:"Assign to me",handler:()=>{this.$resources.bulkAssignTicketToAgent.submit({ticket_ids:Object.keys(this.$refs.miniTicketList.manager.selectedItems),agent_id:this.authStore.userId})}}]}),t.push({group:"All Agents",hideLabel:!0,items:e}),t}else return null}},resources:{bulkAssignTicketStatus(){return{url:"frappedesk.api.ticket.bulk_assign_ticket_status",onSuccess:e=>{this.$refs.miniTicketList.manager.selectedItems=[],this.$refs.miniTicketList.manager.reload(),this.$toast({title:`Tickets marked as ${e.status}.`,icon:"check",iconClasses:"text-green-500"}),this.$event.emit("update_ticket_list")},onError:()=>{this.$toast({title:"Unable to mark tickets as closed.",icon:"x",iconClasses:"text-red-500"})}}},bulkAssignTicketToAgent(){return{url:"frappedesk.api.ticket.bulk_assign_ticket_to_agent",onSuccess:()=>{this.$refs.miniTicketList.manager.selectedItems=[],this.$refs.miniTicketList.manager.reload(),this.$toast({title:"Tickets assigned to agent.",icon:"check",iconClasses:"text-green-500"}),this.$event.emit("update_ticket_list")},onError:()=>{this.$toast({title:"Unable to assign tickets to agent.",icon:"x",iconClasses:"text-red-500"})}}}}},pe={class:"flex flex-col h-full px-4"},fe=o("div",{class:"text-xl font-semibold py-2"},"Tickets",-1),_e={class:"text-xs text-gray-500"},ge={class:"text-gray-500"},he={class:"text-gray-500"},ke={class:"flex flex-row space-x-2"};function xe(e,t,u,n,w,c){const d=i("Subject"),m=i("TicketStatus"),x=i("TicketPriority"),y=i("TicketType"),f=i("Tooltip"),T=i("AgentAvatar"),C=i("Button"),r=i("Dropdown"),_=i("ListViewer"),I=i("ListManager");return p(),g("div",pe,[s(I,{ref:"miniTicketList",options:{doctype:"HD Ticket",fields:["_assign","status","priority","subject","ticket_type","creation","modified","name","_seen"],limit:20,order_by:"modified desc",filters:{contact:["=",u.contact]}}},{body:a(({manager:v})=>[s(_,{options:{base:24,fields:{name:{label:"#",width:"1"},subject:{label:"Subject",width:"9"},status:{label:"Status",width:"3"},ticket_type:{label:"Type",width:"4"},priority:{label:"Priority",width:"5"},creation:{label:"Created",width:"2"},_assign:{label:" ",width:"1",align:"right"}}},class:"text-base h-[93vh] pt-4"},{"top-sub-section-1":a(()=>[fe]),"field-name":a(({value:l})=>[o("div",_e,k(l),1)]),"field-subject":a(({row:l})=>[s(d,{ticket:l},null,8,["ticket"])]),"field-status":a(({value:l})=>[s(m,{value:l},null,8,["value"])]),"field-priority":a(({value:l})=>[s(x,{value:l},null,8,["value"])]),"field-ticket_type":a(({value:l})=>[s(y,{value:l},null,8,["value"])]),"field-creation":a(({value:l})=>[s(f,{placement:"top",text:`Created on ${e.$dayjs(l)}`},{default:a(()=>[o("div",ge,k(e.$dayjs(l).format("DD MMM")),1)]),_:2},1032,["text"])]),"field-modified":a(({value:l})=>[o("div",he,k(e.$dayjs.shortFormating(e.$dayjs(l).fromNow(),!0)),1)]),"field-_assign":a(({value:l})=>[s(T,{agent:JSON.parse(l)[0]},null,8,["agent"])]),"bulk-actions":a(({selectedItems:l})=>[o("div",ke,[s(r,{placement:"right",options:c.agentsAsDropdownOptions()},{default:a(({toggleDropdown:S})=>[s(C,{loading:e.$resources.bulkAssignTicketToAgent.loading,"icon-right":"chevron-down",class:"ml-2",onClick:S},{default:a(()=>[h(" Assign to ")]),_:2},1032,["loading","onClick"])]),_:1},8,["options"]),s(C,{onClick:()=>{e.$resources.bulkAssignTicketStatus.submit({ticket_ids:Object.keys(l),status:"Closed"}).then(()=>{v.unselect(),v.reload()})}},{default:a(()=>[h(" Close Ticket ")]),_:2},1032,["onClick"])])]),_:2},1024)]),_:1},8,["options"])])}const Ce=b(de,[["render",xe]]),ve={name:"Contact",props:["contactId"],components:{ContactInfo:ce,ContactRelatedInfo:Ce}},be={class:"flex flex-col"},we=o("div",{class:"flex border-b h-[52px] px-[24px] shrink-0"},[o("div",{class:"grow my-auto text-[16px] font-semibold text-gray-900"}," Contacts ")],-1),ye={class:"flex flex-row w-full h-full"};function Te(e,t,u,n,w,c){const d=i("ContactInfo"),m=i("ContactRelatedInfo");return p(),g("div",be,[we,o("div",ye,[s(d,{class:"shrink-0 border-r border-[#F4F5F6]",contactId:u.contactId},null,8,["contactId"]),s(m,{class:"grow",contact:u.contactId},null,8,["contact"])])])}const He=b(ve,[["render",Te]]);export{He as default};
