import{_ as g,r as c,o as m,d as f,b as t,a as x,i,h as k,x as I,at as j,t as u,p as C,w as n,k as h,F as V,e as O,m as $}from"./index-d9377e3a.js";import{A as L}from"./Avatar-166461f8.js";import{D as A}from"./Dropdown-e0c50cd3.js";import{C as b}from"./CustomIcons-60888788.js";import{N as R}from"./NewContactDialog-548bc663.js";import{N as q}from"./NewTicketDialog-46160916.js";import{L as P}from"./ListManager-d2a1afc7.js";import{L as H}from"./ListViewer-af42e401.js";import{T as E,a as M,S as U}from"./Subject-97b60af0.js";import{T as Q}from"./TicketStatus-1f4b539e.js";import{B as z}from"./BaseBreadcrumbs-472c50b6.js";import"./use-tracked-pointer-4b3ac621.js";import"./use-resolve-button-type-390b11ae.js";import"./ErrorMessage-e4ff6432.js";import"./Autocomplete-c752a27e.js";import"./use-controllable-93c8440b.js";import"./TextEditor-b1ee2b34.js";import"./listFilters-8ea4c2e9.js";import"./CustomSwitch-323f8131.js";const G={name:"Accordion",props:{isOpen:{type:Boolean,default:!1,required:!0}},components:{CustomIcons:b}},J={class:"mx-5"},K=["aria-expanded","aria-controls"],W=["id"];function X(s,e,d,a,r,l){const _=c("CustomIcons");return m(),f("div",J,[t("button",{onClick:e[0]||(e[0]=()=>{s.$emit("toggle")}),class:"flex flex-row py-2 px-4 bg-[#F9FAFA] rounded text-left items-center","aria-expanded":this.isOpen,"aria-controls":`collapse${s._uid}`},[x(s.$slots,"title"),i(_,{class:k(["float-right",{"rotate-180":d.isOpen}]),name:"chevron-down-accordion"},null,8,["class"])],8,K),I(t("div",{id:`collapse${s._uid}`,class:"px-2"},[x(s.$slots,"data")],8,W),[[j,d.isOpen]])])}const Y=g(G,[["render",X]]),Z={name:"ResolutionBy",props:{ticket:{type:Object,required:!0}},data(){return{overdue:!1}},computed:{value(){return this.ticket.resolution_by?this.ticket.status=="Replied"?"":["Resolved","Closed"].includes(this.ticket.status)?this.ticket.agreement_status=="Overdue"?(this.overdue=!0,"Overdue"):(this.overdue=!1,"Fulfiled"):(this.overdue=this.$dayjs(this.ticket.resolution_by).fromNow().includes("ago"),this.$dayjs.shortFormating(this.$dayjs(this.ticket.resolution_by).fromNow(),!1)):null}}};function ee(s,e,d,a,r,l){return m(),f("div",{class:k(["flex flex-row space-x-1 items-center",{"text-red-500":r.overdue,"text-gray-500":!r.overdue}])},u(l.value),3)}const te=g(Z,[["render",ee]]),se={name:"CustomerInfo",props:["customer"],components:{ResolutionBy:te,TicketType:E,TicketStatus:Q,TicketPriority:M,Subject:U,ListManager:P,ListViewer:H,Dropdown:A,CustomIcons:b,NewContactDialog:R,NewTicketDialog:q,Avatar:L,AccordionCustomer:Y},data(){return{editingTitle:!1,showNewContactDialog:!1,showNewTicketDialog:!1,values:{customerName:"",domain:""}}},setup(){const s=C(!1),e=C(!0);return{toggleContacts:s,toggleTickets:e}},computed:{acronym(){var s=this.customerDoc.customer_name,e=s.match(/\b(\w)/g),d=e.join("");return d},contactDoc(){return this.$resources.contact.data},customerDoc(){return this.$resources.customer.doc&&(this.values.customerName=this.$resources.customer.doc.customer_name,this.values.domain=this.$resources.customer.doc.domain),this.$resources.customer.doc||null}},resources:{customer(){return{type:"document",doctype:"HD Customer",name:this.customer,setValue:{onSuccess(){this.$toast({title:"Customer updated successfully.",icon:"check",iconClasses:"text-green-500"})}}}},renameCustomerDoc(){return{url:"frappe.client.rename_doc",onSuccess:s=>{this.$router.push({path:`/frappedesk/customers/${s}`})}}},contact(){return{url:"frappedesk.api.fdCustomer.get_contact",params:{doctype:"Contact",link_name:this.customer,fields:["*"]},auto:!0}}},methods:{validateInputs(){return!(this.values.customerName==""||this.values.domain=="")},deleteCustomer(){return this.$resources.customer.delete.submit(null,{onSuccess:()=>{this.$toast({title:"Customer deleted",icon:"check",iconClasses:"text-green-500"}),this.resetForm()},auto:!0,onError:s=>{this.$toast({title:"Cannot delete customer",text:s,icon:"x",iconClasses:"text-red-500"})}})},updateCustomer(){this.validateInputs()?(this.$resources.customer.setValue.submit({domain:this.values.domain}),this.values.customerName!==this.customer&&this.$resources.renameCustomerDoc.submit({doctype:"HD Customer",old_name:this.customer,new_name:this.values.customerName})):this.$toast({title:"Please fill all the fields",icon:"x",iconClasses:"text-red-500"})},updateUrlSlug(){let s=this.customer;(!this.$route.params.slug||this.$route.params.slug!==s.slug)&&this.$router.replace({name:"Customer",params:{...this.$route.params,slug:s.slug},query:this.$route.query})},getStatusStyle(s){return{Open:"badge-danger",Resolved:"badge-replied",Closed:"badge-success",Replied:"badge-replied "}[s]},getTypeStyle(s){return{Question:"badge-question",Bug:"badge-bug",Incident:"badge-incident"}[s]}}},oe={key:0,class:"flex flex-col"},re={class:"customer-info flex-1"},ie={class:"flex flex-row"},ne={class:"info basis-1/2 m-[20px]"},le={key:0},ae={class:"max-w-max mb-[10px]"},ce={class:"max-w-max"},ue={key:1},de={class:"flex"},me={class:"bg-[#90C5F4] w-14 h-14 justify-center flex items-center rounded-md font-medium text-white text-2xl"},fe={class:"pl-4"},pe={class:"font-medium text-2xl w-full"},_e={class:"font-light text-base"},he={class:"actions basis-1/2 m-[20px]"},ge={key:0,class:"flex flex-row justify-end"},ve={key:1,class:"flex flex-row justify-end"},xe={class:"customer-table flex-1 grow-1"},Ce={class:"font-medium text-lg flex-1"},ke={class:"flex font-normal text-sm py-2 items-center space-x-3 mx-5 py-2 px-4 border-b border-[#F4F5F6]-200 overflow-y-auto max-h-[calc(100vh-245px)]"},be={class:"w-[30%]"},we={class:"w-[20%]"},ye={class:"w-[20%]"},De={class:"ticket-table flex-1 mt-5 grow-1"},Te={class:"flex-1 font-medium text-lg"},Ne=t("div",null,null,-1),Se=t("div",null,null,-1),Be=t("div",null,null,-1),Fe={class:"text-xs text-gray-500"},Ie={class:"text-gray-500"};function je(s,e,d,a,r,l){const _=c("Input"),p=c("Button"),w=c("router-link"),v=c("AccordionCustomer"),y=c("Subject"),D=c("TicketStatus"),T=c("TicketPriority"),N=c("ListViewer"),S=c("ListManager"),B=c("NewContactDialog"),F=c("NewTicketDialog");return l.customerDoc?(m(),f("div",oe,[t("div",re,[t("div",ie,[t("div",ne,[r.editingTitle?(m(),f("div",le,[t("div",ae,[i(_,{label:"Customer Name",type:"text",value:l.customerDoc.customer_name,onChange:e[0]||(e[0]=o=>{r.values.customerName=o})},null,8,["value"])]),t("div",ce,[i(_,{label:"Domain",type:"text",value:l.customerDoc.domain,onChange:e[1]||(e[1]=o=>{r.values.domain=o})},null,8,["value"])])])):(m(),f("div",ue,[t("div",de,[t("div",me,[t("span",null,u(l.acronym[0])+" "+u(l.acronym[1]),1)]),t("div",fe,[t("div",pe,u(r.values.customerName),1),t("div",_e,u(r.values.domain),1)])])]))]),t("div",he,[r.editingTitle?(m(),f("div",ge,[i(p,{class:"mr-1",appearance:"primary",onClick:e[2]||(e[2]=()=>{l.updateCustomer(),r.editingTitle=!1})},{default:n(()=>[h("Save")]),_:1}),i(p,{class:"mr-1",appearance:"secondary",onClick:e[3]||(e[3]=()=>{r.editingTitle=!1,s.$resources.customer.reload()})},{default:n(()=>[h("Discard")]),_:1})])):(m(),f("div",ve,[i(p,{class:"mr-1",appearance:"secondary","icon-left":"edit",onClick:e[4]||(e[4]=o=>r.editingTitle=!0)},{default:n(()=>[h("Edit")]),_:1}),i(p,{class:"mr-1",appearance:"secondary","icon-left":"plus",onClick:e[5]||(e[5]=()=>{r.showNewContactDialog=!0})},{default:n(()=>[h("Add Contact")]),_:1}),i(p,{class:"mr-1",appearance:"secondary","icon-left":"plus",onClick:e[6]||(e[6]=()=>{r.showNewTicketDialog=!0})},{default:n(()=>[h("Add Ticket")]),_:1})]))])])]),t("div",xe,[i(v,{isOpen:a.toggleContacts,onToggle:e[7]||(e[7]=()=>{a.toggleContacts?a.toggleContacts=!1:(a.toggleTickets&&(a.toggleTickets=!1),a.toggleContacts=!0)}),class:"customer-accordion flex flex-col"},{title:n(()=>[t("span",Ce,"Contacts ("+u(l.customerDoc.contact_count==null?"0":l.customerDoc.contact_count)+") ",1)]),data:n(()=>[(m(!0),f(V,null,O(l.contactDoc,o=>(m(),f("div",ke,[t("div",be,[i(w,{to:`/frappedesk/contacts/${o.name}`},{default:n(()=>[h(u(o.first_name)+" "+u(o.last_name==null?"":o.last_name),1)]),_:2},1032,["to"])]),t("div",we,u(o.email_ids[0].email_id),1),t("div",ye,u(o.phone_nos.length==0?"":o.phone_nos[0].phone),1)]))),256))]),_:1},8,["isOpen"])]),t("div",De,[i(v,{isOpen:a.toggleTickets,onToggle:e[8]||(e[8]=()=>{a.toggleTickets?a.toggleTickets=!1:(a.toggleContacts&&(a.toggleContacts=!1),a.toggleTickets=!0)}),class:"flex flex-col ticket-accordion"},{title:n(()=>[t("span",Te,"Tickets ("+u(l.customerDoc.ticket_count==null?"0":l.customerDoc.ticket_count)+") ",1)]),data:n(()=>[t("div",null,[i(S,{ref:"ticketList",options:{cache:["HD Ticket","Customer",d.customer],saveFiltersLocally:!1,urlQueryFilters:!1,doctype:"HD Ticket",filters:{customer:["=",l.customerDoc.customer_name]},fields:["status","priority","subject","ticket_type","contact","name","_seen"],limit:20,order_by:"modified desc"}},{body:n(()=>[i(N,{options:{base:"12",fields:{name:{label:"#",width:"1"},subject:{label:"Subject",width:"5"},status:{label:"Status",width:"2"},priority:{label:"Priority",width:"2"},contact:{label:"Created By",width:"2"}}},class:"text-base h-[calc(100vh-245px)]"},{"top-section":n(()=>[Ne]),header:n(()=>[Se]),"row-checkbox":n(()=>[Be]),"field-name":n(({value:o})=>[t("div",Fe,u(o),1)]),"field-subject":n(({row:o})=>[i(y,{ticket:o},null,8,["ticket"])]),"field-status":n(({value:o})=>[i(D,{value:o},null,8,["value"])]),"field-priority":n(({value:o})=>[i(T,{value:o},null,8,["value"])]),"field-contact":n(({value:o})=>[t("div",Ie,u(o),1)]),_:1})]),_:1},8,["options"])])]),_:1},8,["isOpen"])]),i(B,{modelValue:r.showNewContactDialog,"onUpdate:modelValue":e[9]||(e[9]=o=>r.showNewContactDialog=o),fdCustomer:d.customer,onContactCreated:e[10]||(e[10]=()=>{r.showNewContactDialog=!1,s.$router.go()})},null,8,["modelValue","fdCustomer"]),i(F,{modelValue:r.showNewTicketDialog,"onUpdate:modelValue":e[11]||(e[11]=o=>r.showNewTicketDialog=o),fdCustomer:d.customer,onClose:e[12]||(e[12]=o=>r.showNewTicketDialog=!1),onTicketCreated:e[13]||(e[13]=()=>{r.showNewTicketDialog=!1,s.$router.go()})},null,8,["modelValue","fdCustomer"])])):$("",!0)}const Ve=g(se,[["render",je]]),Oe={name:"Customer",props:["customerId"],components:{CustomerInfo:Ve,BaseBreadcrumbs:z}},$e={class:"flex flex-col max-h-screen"},Le={class:"flex border-b h-[52px] px-[24px] shrink-0"},Ae={class:"grow my-auto"},Re={class:"customer max-h-[calc(100vh-52px)]"};function qe(s,e,d,a,r,l){const _=c("BaseBreadcrumbs"),p=c("CustomerInfo");return m(),f("div",$e,[t("div",Le,[t("div",Ae,[i(_,{breadcrumbs:[{label:"Customers",name:"customer",handler:()=>{s.$router.push({path:"/frappedesk/customers"})}},{label:`${d.customerId}`,name:"customerId"}]},null,8,["breadcrumbs"])])]),t("div",Re,[i(p,{class:"flex border-r border-[#F4F5F6] w-full",customer:d.customerId},null,8,["customer"])])])}const it=g(Oe,[["render",qe]]);export{it as default};
