import{_ as w,I as y,v as B,D as $,i as j,A,r as d,o,k as r,l as i,m as n,w as _,t as p,x as b,b as x,n as f,q as O,y as C,z as D,p as V,h as L,C as N,E as F}from"./vendor.1fecb205.js";import{Q as R}from"./vue-quill.snow.e0554409.js";const S={name:"TicketListItem",props:["ticket"],inject:["agents","types","statuses","priorities"],components:{Input:y,Badge:B,Dropdown:$,FeatherIcon:j,Avatar:A},data(){return{ticketRefreshed:!1,localTicket:null}},methods:{getBadgeColorBasedOnStatus(e){if(["Open"].includes(e))return"fill-green-500";if(["Closed","Resolved"].includes(e))return"fill-red-500";if(["Replied"].includes(e))return"fill-yellow-500";if(["On Hold"].includes(e))return"fill-blue-500"},getColorBasedOnPriority(e,t){let s="";t=="icon"?s="stroke":t=="text"&&(s="text");let l="";return e=="High"?l="red-500":e=="Medium"?l="yellow-500":e=="Low"&&(l="green-500"),s?s+"-"+l:l},getIconBasedOnPriority(e){if(e=="High"||e=="Medium")return"arrow-up";if(e=="Low")return"arrow-down"},agentsAsDropdownOptions(){let e=[];if(this.agents){this.$agents.get().forEach(s=>{e.push({label:s.agent_name,handler:()=>{this.$tickets(this.ticket.name).assignAgent(s.name)}})});let t=[];return this.$user.get().agent&&t.push({group:"Myself",hideLabel:!0,items:[{label:"Assign to me",handler:()=>{this.$tickets(this.ticket.name).assignAgent()}}]}),t.push({group:"All Agents",hideLabel:!0,items:e}),t}else return null},typesAsDropdownOptions(){let e=[];return this.$tickets().get("types")?(this.$tickets().get("types").forEach(t=>{e.push({label:t,handler:()=>{this.$tickets(this.ticket.name).assignType(t)}})}),e):null},statusesAsDropdownOptions(){let e=[];return this.$tickets().get("statuses")?(this.$tickets().get("statuses").forEach(t=>{e.push({label:t,handler:()=>{this.$tickets(this.ticket.name).assignStatus(t)}})}),e):null},prioritiesAsDropdownOptions(){let e=[];return this.$tickets().get("priorities")?(this.$tickets().get("priorities").forEach(t=>{e.push({label:t,handler:()=>{this.$tickets(this.ticket.name).assignPriority(t)}})}),e):null},getResolutionDueIn(e,t){if(["Fulfilled","Overdue"].includes(t))return t;let s=this.$dayjs().to(e);return s.includes("in")?"Due "+s:"Overdue"},getResolutionBadgeColor(e,t){return this.$dayjs().to(e).includes("in")?t=="Fulfilled"?"green":"":"red"}}},E={class:"block py-4 hover:bg-gray-50 border-b"},q={key:0,class:"group flex items-center justify-between sm:justify-start font-light pl-4 pr-8"},U={class:"mr-4"},P={class:"flex flex-col space-y-1"},z={class:"flex items-center"},H={class:"text-base font-medium"},M={class:"ml-1 text-base text-slate-400"},W={class:"ml-1"},Q={class:"flex items-center"},G={class:"flex"},J={class:"ml-1 text-base"},K={class:"flex items-center justify-between sm:justify-start font-light sm:w-6/12"},X=["onClick"],Y={key:0,class:"flex items-center"},Z={class:"ml-1 text-gray-500"},ee={key:1,class:"hidden group-hover:block"},te=i("span",{class:"text-base text-gray-400"}," set type ",-1),se=[te],ie={class:"w-full cursor-pointer"},oe=["onClick"],ne={class:"ml-1 text-gray-500"},le={key:1,class:"hidden group-hover:block"},ce=i("span",{class:"text-base text-gray-400"}," set priority ",-1),re=[ce],ae={class:"w-full cursor-pointer"},de=["onClick"],ue={class:"ml-1 text-gray-500"},he={key:1,class:"hidden group-hover:block"},_e=i("span",{class:"text-base text-gray-400"}," set status ",-1),ke=[_e],pe={class:"hidden sm:w-1/12 text-base text-gray-600 sm:block"},me={class:"flex items-center"},ge={class:"ml-1"},fe={class:"sm:w-1/12"},ve=["onClick"],we={key:0},ye={key:1,class:"hidden group-hover:block"},be=i("span",{class:"text-base text-gray-400"}," assign agent ",-1),xe=[be],Te=i("div",{class:"transform translate-y-2"},null,-1);function Ce(e,t,s,l,c,a){const m=d("Input"),k=d("Badge"),h=d("FeatherIcon"),v=d("router-link"),u=d("Dropdown"),I=d("Avatar");return o(),r("div",E,[s.ticket?(o(),r("div",q,[i("div",U,[n(m,{type:"checkbox",value:""})]),n(v,{to:`/helpdesk/tickets/${s.ticket.name}`,class:"sm:w-9/12"},{default:_(()=>[i("div",P,[i("div",z,[i("div",H,p(s.ticket.subject),1),i("div",M,"#"+p(s.ticket.name),1),i("div",W,[n(k,{color:a.getResolutionBadgeColor(s.ticket.resolution_by,s.ticket.agreement_status)},{default:_(()=>[b(p(a.getResolutionDueIn(s.ticket.resolution_by,s.ticket.agreement_status)),1)]),_:1},8,["color"])])]),i("div",Q,[i("div",G,[n(h,{class:"w-4 h-4 stroke-slate-400",name:"user"}),i("div",J,p(s.ticket.contact),1)])])])]),_:1},8,["to"]),i("div",K,[a.types?(o(),x(u,{key:0,placement:"left",options:a.typesAsDropdownOptions(),"dropdown-width-full":!0,class:"text-base sm:w-4/12"},{default:_(({toggleTypes:g})=>[i("div",{class:"w-full",onClick:g},[s.ticket.ticket_type?(o(),r("div",Y,[i("div",null,[n(h,{class:"w-3 h-3 stroke-slate-400",name:"tag"})]),i("div",Z,p(s.ticket.ticket_type),1),n(h,{class:"w-2 h-2 ml-1 hidden group-hover:block",name:"chevron-down"})])):(o(),r("div",ee,se))],8,X)]),_:1},8,["options"])):f("",!0),a.priorities?(o(),x(u,{key:1,placement:"left",options:a.prioritiesAsDropdownOptions(),"dropdown-width-full":!0,class:"text-base sm:w-4/12"},{default:_(({togglePriority:g})=>[i("div",ie,[s.ticket.priority?(o(),r("div",{key:0,onClick:g,class:"flex items-center"},[n(h,{class:"w-3 h-3",name:a.getIconBasedOnPriority(s.ticket.priority)},null,8,["name"]),i("div",ne,p(s.ticket.priority),1),n(h,{class:"w-2 h-2 ml-1 hidden group-hover:block",name:"chevron-down"})],8,oe)):(o(),r("div",le,re))])]),_:1},8,["options"])):f("",!0),this.statuses?(o(),x(u,{key:2,placement:"left",options:a.statusesAsDropdownOptions(),"dropdown-width-full":!0,class:"text-base sm:w-4/12"},{default:_(({toggleStatuses:g})=>[i("div",ae,[s.ticket.status?(o(),r("div",{key:0,onClick:g,class:"flex items-center"},[n(h,{class:O(["w-2 h-2 stroke-transparent",a.getBadgeColorBasedOnStatus(s.ticket.status)]),name:"circle"},null,8,["class"]),i("div",ue,p(s.ticket.status),1),n(h,{class:"w-2 h-2 ml-1 hidden group-hover:block",name:"chevron-down"})],8,de)):(o(),r("div",he,ke))])]),_:1},8,["options"])):f("",!0),i("div",pe,[i("div",me,[i("div",null,[n(h,{class:"w-3 h-3 stroke-slate-400",name:"edit-2"})]),i("div",ge,p(e.$dayjs(s.ticket.modified).fromNow()),1)])])]),i("div",fe,[this.agents?(o(),x(u,{key:0,placement:"right",options:a.agentsAsDropdownOptions(),"dropdown-width-full":!0,class:"text-base flex flex-row-reverse"},{default:_(({toggleAssignees:g})=>[i("div",{onClick:g},[s.ticket.assignees.length>0?(o(),r("div",we,[(o(!0),r(C,null,D(s.ticket.assignees,T=>(o(),r("div",{key:T},[n(I,{class:"w-4 h-4",label:T.agent_name,imageURL:T.image},null,8,["label","imageURL"])]))),128))])):(o(),r("div",ye,xe))],8,ve)]),_:1},8,["options"])):f("",!0)])])):f("",!0),Te])}var De=w(S,[["render",Ce]]);const Ie={name:"TicketList",inject:["viewportWidth"],props:["tickets"],components:{Input:y,TicketListItem:De},computed:{tickets(){let e=this.$tickets().get(),t=this.$ticketFilter.get(),s=[];if(t=="Assigned to me"){for(let l in e)if(e[l].assignees.length>0)for(let c=0;c<e[l].assignees.length;c++)e[l].assignees[c].name==this.$user.get().agent.name&&s.push(e[l])}else s=e;return s}}},Be={class:"block px-0"};function $e(e,t,s,l,c,a){const m=d("TicketListItem");return o(),r("div",null,[i("div",null,[this.tickets?(o(),r("div",{key:0,class:"w-full block overflow-auto",style:V({height:a.viewportWidth>768?"calc(100vh - 7.3rem)":null})},[(o(!0),r(C,null,D(a.tickets,k=>(o(),r("div",{class:"flex-auto",key:k.name},[i("div",Be,[n(m,{ticket:k},null,8,["ticket"])])]))),128))],4)):f("",!0)])])}var je=w(Ie,[["render",$e]]);const Ae={name:"NewTicketDialog",props:{modelValue:{type:Boolean,required:!0}},setup(e,{emit:t}){const s=L(null);let l=N({get:()=>e.modelValue,set:c=>{t("update:modelValue",c),c||t("close")}});return{editor:s,open:l}},data(){return{subject:"",description:"",descriptionContent:"",editorOptions:{modules:{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],["image"],[{align:[]}],["clean"]]},placeholder:"Compose your reply...",theme:"snow",bounds:7}}},components:{Input:y,QuillEditor:R,Dialog:F},methods:{createTicket(){this.$tickets().createTicket({subject:this.subject,description:this.descriptionContent}),this.$emit("ticketCreated")}}},Oe={class:"space-y-4"},Ve=i("span",{class:"block mb-2 text-sm leading-4 text-gray-700"}," Description ",-1),Le={class:"flex float-right space-x-2"},Ne=b("Create");function Fe(e,t,s,l,c,a){const m=d("Input"),k=d("quill-editor"),h=d("Button"),v=d("Dialog");return o(),r("div",null,[n(v,{options:{title:"Create New Ticket"},modelValue:l.open,"onUpdate:modelValue":t[3]||(t[3]=u=>l.open=u)},{"body-content":_(()=>[i("div",Oe,[n(m,{label:"Subject",type:"text",modelValue:c.subject,"onUpdate:modelValue":t[0]||(t[0]=u=>c.subject=u)},null,8,["modelValue"]),i("div",null,[Ve,n(k,{ref:l.editor,content:c.descriptionContent,"onUpdate:content":t[1]||(t[1]=u=>c.descriptionContent=u),contentType:"html",options:c.editorOptions,style:{"min-height":"150px","max-height":"200px","overflow-y":"auto"}},null,8,["content","options"])]),i("div",Le,[n(h,{appearance:"primary",onClick:t[2]||(t[2]=u=>a.createTicket())},{default:_(()=>[Ne]),_:1})])])]),_:1},8,["modelValue"])])}var Re=w(Ae,[["render",Fe]]);const Se={name:"Tickets",inject:["viewportWidth"],components:{TicketList:je,Input:y,NewTicketDialog:Re},provide:{types:[],priorities:[],statuses:[],agents:[]},data(){return{showNewTicketDialog:!1}},resources:{tickets(){return{method:"helpdesk.api.ticket.get_tickets",params:{filter:this.$ticketFilter.get()},auto:!0}},agents(){return{method:"helpdesk.api.agent.get_all",auto:!0}},types(){return{method:"helpdesk.api.ticket.get_all_ticket_types",auto:!0}},statuses(){return{method:"helpdesk.api.ticket.get_all_ticket_statuses",auto:!0}},priorities(){return{method:"helpdesk.api.ticket.get_all_ticket_priorities",auto:!0}}},computed:{tickets(){return this.$resources.tickets.data||null},agents(){return this.$resources.agents.data||null},types(){return this.$resources.types.data||null},statuses(){return this.$resources.statuses.data||null},priorities(){return this.$resources.priorities.data||null}},mounted(){},activated(){this.$socket.on("list_update",e=>{e.doctype=="Ticket"&&this.$resources.tickets.fetch()}),this.$currentPage.set("Tickets"),console.log("tickets activated")},deactivated(){this.$socket.off("list_update")}},Ee={class:"flow-root border-b pt-2 pb-3 pr-8"},qe={class:"float-left ml-4"},Ue={class:"flex items-center space-x-4"},Pe=b("Add Ticket"),ze={class:"float-right"},He=b("Filter"),Me={key:0};function We(e,t,s,l,c,a){const m=d("Input"),k=d("Button"),h=d("TicketList"),v=d("NewTicketDialog");return o(),r("div",null,[i("div",Ee,[i("div",qe,[i("div",Ue,[n(m,{type:"checkbox",value:""}),n(k,{"icon-left":"plus",appearance:"primary",onClick:t[0]||(t[0]=()=>{c.showNewTicketDialog=!0})},{default:_(()=>[Pe]),_:1})])]),i("div",ze,[n(k,{"icon-left":"filter",type:"white"},{default:_(()=>[He]),_:1})])]),a.tickets?(o(),r("div",Me,[n(h,{tickets:a.tickets},null,8,["tickets"])])):f("",!0),n(v,{modelValue:c.showNewTicketDialog,"onUpdate:modelValue":t[1]||(t[1]=u=>c.showNewTicketDialog=u),onTicketCreated:t[2]||(t[2]=()=>{c.showNewTicketDialog=!1})},null,8,["modelValue"])])}var Je=w(Se,[["render",We]]);export{Je as default};
