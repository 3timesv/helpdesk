import{_ as g,s as k,T as w,p as f,o as l,d as c,b as s,i as a,w as u,k as x,q as I,F as b,e as N,t as E,m as $,r}from"./index-d9377e3a.js";import{E as S}from"./ErrorMessage-e4ff6432.js";import{A as U}from"./Autocomplete-c752a27e.js";import"./CustomIcons-60888788.js";import"./use-tracked-pointer-4b3ac621.js";import"./use-resolve-button-type-390b11ae.js";import"./use-controllable-93c8440b.js";const V={name:"TeamInfo",components:{Autocomplete:U,ErrorMessage:S,FeatherIcon:k,Tooltip:w},props:{teamId:{type:String,default:""}},setup(){const t=f({ignore_restrictions:!1,team_name:"",users:[]}),m=f({title:""});return{isTeamNameChanged:!1,team:t,teamInputErrors:m}},data(){return{autoCompleteOptions:{url:"frappedesk.extends.client.get_list",inputMap:e=>({doctype:"HD Agent",fields:["name","agent_name"],filters:{name:["like",`%${e}%`]}}),responseMap:e=>e.map(t=>({label:t.agent_name,value:t.name}))}}},resources:{team(){if(this.teamId)return{type:"document",doctype:"HD Team",name:this.teamId,fields:["name","users"],whitelistedMethods:{renameTeam:"rename_self"},onSuccess(e){e.users=e.users.map(t=>t.user),this.team=e},onError:e=>{this.$toast({title:"Error Fetching Team",text:e,icon:"x",iconClasses:"text-red-500"})},setValue:{onSuccess:()=>{this.$toast({title:"Team Updated",icon:"check",iconClasses:"text-green-500"})},onError:e=>{this.$toast({title:"Error While Updating Ticket Type",text:e,icon:"x",iconClasses:"text-red-500"})}}}},newTeam(){return{url:"frappe.client.insert",onSuccess:e=>{this.$router.push({path:`/frappedesk/settings/teams/${e.name}`}),this.$toast({title:"New Team Created",icon:"check",iconClasses:"text-green-500"})}}}},methods:{validate(){const e=this.team.team_name;return e===""?(this.teamInputErrors.title="Team name is required",!1):e.toLowerCase()==="new"?(this.teamInputErrors.title=`Team name cannot be '${e}'`,!1):!0},renameTeam(){if(!this.isTeamNameChanged)return;const e=this.team.team_name;this.$resources.team.renameTeam.submit({new_name:e}).then(()=>{this.$router.push({path:`/frappedesk/settings/teams/${e}`})})},teamDisplayName(e){if(e.team_name)return e.team_name;if(e.name)return e.name;if(this.teamId)return this.teamId},userDisplayName(e){return e.user?e.user:e},mapUsers(e){return e.map(t=>({user:t}))},saveNew(){this.$resources.newTeam.submit({doc:{doctype:"HD Team",ignore_restrictions:this.team.ignore_restrictions,team_name:this.team.team_name,users:this.mapUsers(this.team.users)}})},save(){this.$resources.team.setValue.submit({ignore_restrictions:this.team.ignore_restrictions,users:this.mapUsers(this.team.users)}).then(this.renameTeam)},onNameChange(e){this.isTeamNameChanged=this.team.team_name!==e,this.team.team_name=e},onAutocompleteChange(e){const t=e.value;this.team.users.includes(t)||this.team.users.push(t)},onUserClick(e){this.team.users=this.team.users.filter(t=>t!==e)},cancel(){this.$router.go()},onSave(){if(this.validate()){if(!this.$resources.team){this.saveNew();return}this.save()}}}},A={class:"min-w-[490px] px-[24px] py-[10px]"},D={class:"flow-root h-[72px] shrink-0 py-[22px] px-[16px]"},M={class:"float-left"},B=s("div",null,"Back to team list",-1),F={class:"float-right"},L={class:"flex flex-row space-x-2"},H={key:0,class:"flex h-full flex-row space-x-[24px] border-t px-[16px] py-[22px]"},q={class:"flex h-full w-full flex-col space-y-[16px]"},O={class:"w-full space-y-1"},R=s("div",null,[s("span",{class:"block text-sm leading-4 text-gray-700"}," Users ")],-1),W={class:"flex max-h-[300px] min-h-[100px] flex-col overflow-y-auto rounded border bg-gray-100 px-2"},j={class:"flex flex-wrap gap-2 py-2"},z={class:"ml-2 text-base"},G=["onClick"],J={class:"w-max"};function K(e,t,m,o,d,n){const p=r("FeatherIcon"),v=r("router-link"),h=r("Button"),_=r("Input"),y=r("ErrorMessage"),T=r("Autocomplete"),C=r("Tooltip");return l(),c("div",A,[s("div",D,[s("div",M,[a(v,{to:"/frappedesk/settings/teams",class:"my-1 flex select-none flex-row items-center space-x-1 stroke-gray-600 text-[12px] text-gray-600 hover:stroke-gray-700 hover:text-gray-700",role:"button"},{default:u(()=>[a(p,{name:"arrow-left",class:"h-[13px] w-[13px]"}),B]),_:1})]),s("div",F,[s("div",L,[a(h,{appearance:"secondary",onClick:n.cancel},{default:u(()=>[x("Cancel")]),_:1},8,["onClick"]),a(h,{appearance:"primary",onClick:n.onSave},{default:u(()=>[x("Save")]),_:1},8,["onClick"])])])]),o.team?(l(),c("div",H,[s("div",q,[s("div",null,[a(_,{label:"Title",type:"text",value:n.teamDisplayName(o.team),onInput:n.onNameChange},null,8,["value","onInput"]),a(y,{message:o.teamInputErrors.title},null,8,["message"])]),s("form",{class:"flex flex-row items-end space-x-2",onSubmit:t[0]||(t[0]=I((...i)=>e.onSubmit&&e.onSubmit(...i),["prevent"]))},[s("div",O,[R,a(T,{id:"searchInput",value:"","resource-options":d.autoCompleteOptions,onChange:n.onAutocompleteChange},null,8,["resource-options","onChange"])])],32),s("div",W,[s("ul",j,[(l(!0),c(b,null,N(o.team.users,i=>(l(),c("li",{key:i,class:"flex items-center space-x-2 rounded bg-white p-1 shadow"},[s("span",z,E(n.userDisplayName(i)),1),s("button",{class:"grid h-4 w-4 place-items-center rounded text-gray-700 hover:bg-gray-300",onClick:()=>n.onUserClick(i)},[a(p,{class:"w-3",name:"x"})],8,G)]))),128))])]),s("div",J,[a(C,{text:"Agents belonging to this group can ignore any restrictions"},{default:u(()=>[a(_,{modelValue:o.team.ignore_restrictions,"onUpdate:modelValue":t[1]||(t[1]=i=>o.team.ignore_restrictions=i),label:"Ignore Restrictions",type:"checkbox"},null,8,["modelValue"])]),_:1})])])])):$("",!0)])}const P=g(V,[["render",K]]),Q={name:"Team",props:["teamId"],components:{TeamInfo:P},setup(){},mounted(){this.$event.emit("set-selected-setting","Teams")}},X={class:"flex flex-col"};function Y(e,t,m,o,d,n){const p=r("TeamInfo");return l(),c("div",X,[a(p,{teamId:m.teamId},null,8,["teamId"])])}const oe=g(Q,[["render",Y]]);export{oe as default};
