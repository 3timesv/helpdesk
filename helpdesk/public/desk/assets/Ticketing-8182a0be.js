import{_ as h,u as p,p as i,d as l,c as n,w as m,m as d,r as _,o as a,bB as f,H as o}from"./index-d9377e3a.js";const g={name:"Ticketing",setup(){const t=p(),e=i(),s=i([]),r=i({}),c=i();return o("impersonateContact",c),o("tickets",e),o("ticketTemplates",s),o("ticketController",r),{authStore:t,tickets:e,ticketTemplates:s,ticketController:r,impersonateContact:c}},mounted(){this.authStore.isLoggedIn||this.$router.push({name:"PortalLogin",query:{route:this.$route.path}}),this.authStore.isAdmin||this.authStore.isAgent?this.impersonateContact=t=>this.$resources.tickets.fetch({impersonate:t}):this.impersonateContact=()=>{this.$router.push({path:"/support/tickets"}),this.$resources.tickets.fetch()},this.ticketController.update=t=>{t?this.$resources.ticket.fetch({ticket_id:t}):this.$resources.tickets.fetch()},this.ticketController.newTicket=(t,e,s)=>(this.$resources.createTicket.submit({values:t,template:e,attachments:s,via_customer_portal:!0}),this.$resources.createTicket.loading),this.ticketController.set=(t,e,s=null)=>{switch(e){case"status":this.$resources.assignTicketStatus.submit({ticket_id:t,status:s});break}},this.$socket.on("list_update",t=>{switch(t.doctype){case"Ticket":this.ticketController.update();break}})},resources:{tickets(){return{url:"frappedesk.frappedesk.doctype.hd_ticket.hd_ticket.get_user_tickets",auto:this.authStore.isLoggedIn&&this.$route.name!="Impersonate",onSuccess:t=>{this.tickets={};for(var e=0;e<t.length;e++)this.tickets[t[e].name]=t[e]}}},ticket(){return{url:"frappedesk.api.ticket.get_ticket",onSuccess:t=>{this.tickets[t.name]=t}}},templates(){return{url:"frappedesk.api.ticket.get_all_ticket_templates",auto:this.authStore.isLoggedIn,onSuccess:t=>{this.ticketTemplates=t}}},assignTicketStatus(){return{url:"frappedesk.api.ticket.assign_ticket_status",onSuccess:t=>{this.ticketController.update(t.name)}}},createTicket(){return{url:"frappedesk.api.ticket.create_new",onSuccess:t=>{this.ticketController.update(),this.$router.push({name:"PortalTicket",params:{ticketId:t.name}})},onError:t=>{this.$toast({title:"Error while creating ticket",text:t.messages.join(" "),icon:"x",iconClasses:"text-red-500"})}}}}},$={key:0};function C(t,e,s,r,c,S){const u=_("router-view");return r.authStore.isLoggedIn?(a(),l("div",$,[(a(),n(u,{key:t.$route.fullPath},{default:m(({Component:k})=>[(a(),n(f(k)))]),_:1}))])):d("",!0)}const w=h(g,[["render",C]]);export{w as default};
