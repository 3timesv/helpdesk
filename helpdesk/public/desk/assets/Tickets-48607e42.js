import{C as $,p as S,M as w,W as R,X as M,Y as Pe,Z as Oe,$ as Te,a0 as v,H as re,a1 as Le,a2 as q,R as G,O as me,U as W,a3 as se,a4 as He,a5 as ne,a6 as H,a7 as Ue,F as ee,a8 as V,a9 as ye,aa as Z,ab as _e,Q as ue,V as J,v as ce,ac as ze,ad as F,ae as de,af as ke,ag as Qe,ah as Fe,ai as K,aj as z,J as Ge,ak as Q,al as ge,K as xe,am as De,o as A,d as j,i as x,w as I,b,t as D,E as T,h as ie,k as U,r as B,s as le,_ as Ie,c as ae,m as he,an as Ee,e as Se,ao as te,ap as Ke,aq as Be,ar as We,as as Ae,u as Je,x as fe,at as be,au as Xe}from"./index-d9377e3a.js";import{D as Ce}from"./Dropdown-e0c50cd3.js";import{N as Ye}from"./NewTicketDialog-46160916.js";import{u as pe}from"./listFilters-8ea4c2e9.js";import{x as Ze,a as C,u as et}from"./use-tracked-pointer-4b3ac621.js";import{b as Re}from"./use-resolve-button-type-390b11ae.js";import{d as tt,e as lt}from"./use-controllable-93c8440b.js";import{A as at}from"./Avatar-166461f8.js";import"./ErrorMessage-e4ff6432.js";import"./TextEditor-b1ee2b34.js";import"./Autocomplete-c752a27e.js";import"./CustomIcons-60888788.js";function ot(t,n){return t===n}var st=(t=>(t[t.Open=0]="Open",t[t.Closed=1]="Closed",t))(st||{}),nt=(t=>(t[t.Single=0]="Single",t[t.Multi=1]="Multi",t))(nt||{}),it=(t=>(t[t.Pointer=0]="Pointer",t[t.Other=1]="Other",t))(it||{});function rt(t){requestAnimationFrame(()=>requestAnimationFrame(t))}let $e=Symbol("ListboxContext");function oe(t){let n=ce($e,null);if(n===null){let i=new Error(`<${t} /> is missing a parent <Listbox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(i,oe),i}return n}let ut=$({name:"Listbox",emits:{"update:modelValue":t=>!0},props:{as:{type:[Object,String],default:"template"},disabled:{type:[Boolean],default:!1},by:{type:[String,Function],default:()=>ot},horizontal:{type:[Boolean],default:!1},modelValue:{type:[Object,String,Number,Boolean],default:void 0},defaultValue:{type:[Object,String,Number,Boolean],default:void 0},name:{type:String,optional:!0},multiple:{type:[Boolean],default:!1}},inheritAttrs:!1,setup(t,{slots:n,attrs:i,emit:u}){let e=S(1),l=S(null),f=S(null),g=S(null),h=S([]),o=S(""),r=S(null),m=S(1);function _(a=c=>c){let c=r.value!==null?h.value[r.value]:null,d=ze(a(h.value.slice()),P=>v(P.dataRef.domRef)),y=c?d.indexOf(c):null;return y===-1&&(y=null),{options:d,activeOptionIndex:y}}let k=w(()=>t.multiple?1:0),[O,L]=tt(w(()=>t.modelValue===void 0?R(k.value,{[1]:[],[0]:void 0}):t.modelValue),a=>u("update:modelValue",a),w(()=>t.defaultValue)),s={listboxState:e,value:O,mode:k,compare(a,c){if(typeof t.by=="string"){let d=t.by;return a?.[d]===c?.[d]}return t.by(a,c)},orientation:w(()=>t.horizontal?"horizontal":"vertical"),labelRef:l,buttonRef:f,optionsRef:g,disabled:w(()=>t.disabled),options:h,searchQuery:o,activeOptionIndex:r,activationTrigger:m,closeListbox(){t.disabled||e.value!==1&&(e.value=1,r.value=null)},openListbox(){t.disabled||e.value!==0&&(e.value=0)},goToOption(a,c,d){if(t.disabled||e.value===1)return;let y=_(),P=Ze(a===C.Specific?{focus:C.Specific,id:c}:{focus:a},{resolveItems:()=>y.options,resolveActiveIndex:()=>y.activeOptionIndex,resolveId:E=>E.id,resolveDisabled:E=>E.dataRef.disabled});o.value="",r.value=P,m.value=d??1,h.value=y.options},search(a){if(t.disabled||e.value===1)return;let c=o.value!==""?0:1;o.value+=a.toLowerCase();let d=(r.value!==null?h.value.slice(r.value+c).concat(h.value.slice(0,r.value+c)):h.value).find(P=>P.dataRef.textValue.startsWith(o.value)&&!P.dataRef.disabled),y=d?h.value.indexOf(d):-1;y===-1||y===r.value||(r.value=y,m.value=1)},clearSearch(){t.disabled||e.value!==1&&o.value!==""&&(o.value="")},registerOption(a,c){let d=_(y=>[...y,{id:a,dataRef:c}]);h.value=d.options,r.value=d.activeOptionIndex},unregisterOption(a){let c=_(d=>{let y=d.findIndex(P=>P.id===a);return y!==-1&&d.splice(y,1),d});h.value=c.options,r.value=c.activeOptionIndex,m.value=1},select(a){t.disabled||L(R(k.value,{[0]:()=>a,[1]:()=>{let c=M(s.value.value).slice(),d=M(a),y=c.findIndex(P=>s.compare(d,M(P)));return y===-1?c.push(d):c.splice(y,1),c}}))}};Pe([f,g],(a,c)=>{var d;s.closeListbox(),Oe(c,Te.Loose)||(a.preventDefault(),(d=v(f))==null||d.focus())},w(()=>e.value===0)),re($e,s),Le(w(()=>R(e.value,{[0]:q.Open,[1]:q.Closed})));let p=w(()=>{var a;return(a=v(f))==null?void 0:a.closest("form")});return G(()=>{me([p],()=>{if(!p.value||t.defaultValue===void 0)return;function a(){s.select(t.defaultValue)}return p.value.addEventListener("reset",a),()=>{var c;(c=p.value)==null||c.removeEventListener("reset",a)}},{immediate:!0})}),()=>{let{name:a,modelValue:c,disabled:d,...y}=t,P={open:e.value===0,disabled:d,value:O.value};return W(ee,[...a!=null&&O.value!=null?lt({[a]:O.value}).map(([E,N])=>W(se,He({features:ne.Hidden,key:E,as:"input",type:"hidden",hidden:!0,readOnly:!0,name:E,value:N}))):[],H({ourProps:{},theirProps:{...i,...Ue(y,["defaultValue","onUpdate:modelValue","horizontal","multiple","by"])},slot:P,slots:n,attrs:i,name:"Listbox"})])}}});$({name:"ListboxLabel",props:{as:{type:[Object,String],default:"label"},id:{type:String,default:()=>`headlessui-listbox-label-${V()}`}},setup(t,{attrs:n,slots:i}){let u=oe("ListboxLabel");function e(){var l;(l=v(u.buttonRef))==null||l.focus({preventScroll:!0})}return()=>{let l={open:u.listboxState.value===0,disabled:u.disabled.value},{id:f,...g}=t,h={id:f,ref:u.labelRef,onClick:e};return H({ourProps:h,theirProps:g,slot:l,attrs:n,slots:i,name:"ListboxLabel"})}}});let ct=$({name:"ListboxButton",props:{as:{type:[Object,String],default:"button"},id:{type:String,default:()=>`headlessui-listbox-button-${V()}`}},setup(t,{attrs:n,slots:i,expose:u}){let e=oe("ListboxButton");u({el:e.buttonRef,$el:e.buttonRef});function l(o){switch(o.key){case F.Space:case F.Enter:case F.ArrowDown:o.preventDefault(),e.openListbox(),J(()=>{var r;(r=v(e.optionsRef))==null||r.focus({preventScroll:!0}),e.value.value||e.goToOption(C.First)});break;case F.ArrowUp:o.preventDefault(),e.openListbox(),J(()=>{var r;(r=v(e.optionsRef))==null||r.focus({preventScroll:!0}),e.value.value||e.goToOption(C.Last)});break}}function f(o){switch(o.key){case F.Space:o.preventDefault();break}}function g(o){e.disabled.value||(e.listboxState.value===0?(e.closeListbox(),J(()=>{var r;return(r=v(e.buttonRef))==null?void 0:r.focus({preventScroll:!0})})):(o.preventDefault(),e.openListbox(),rt(()=>{var r;return(r=v(e.optionsRef))==null?void 0:r.focus({preventScroll:!0})})))}let h=Re(w(()=>({as:t.as,type:n.type})),e.buttonRef);return()=>{var o,r;let m={open:e.listboxState.value===0,disabled:e.disabled.value,value:e.value.value},{id:_,...k}=t,O={ref:e.buttonRef,id:_,type:h.value,"aria-haspopup":"listbox","aria-controls":(o=v(e.optionsRef))==null?void 0:o.id,"aria-expanded":e.disabled.value?void 0:e.listboxState.value===0,"aria-labelledby":e.labelRef.value?[(r=v(e.labelRef))==null?void 0:r.id,_].join(" "):void 0,disabled:e.disabled.value===!0?!0:void 0,onKeydown:l,onKeyup:f,onClick:g};return H({ourProps:O,theirProps:k,slot:m,attrs:n,slots:i,name:"ListboxButton"})}}}),dt=$({name:"ListboxOptions",props:{as:{type:[Object,String],default:"ul"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:()=>`headlessui-listbox-options-${V()}`}},setup(t,{attrs:n,slots:i,expose:u}){let e=oe("ListboxOptions"),l=S(null);u({el:e.optionsRef,$el:e.optionsRef});function f(o){switch(l.value&&clearTimeout(l.value),o.key){case F.Space:if(e.searchQuery.value!=="")return o.preventDefault(),o.stopPropagation(),e.search(o.key);case F.Enter:if(o.preventDefault(),o.stopPropagation(),e.activeOptionIndex.value!==null){let r=e.options.value[e.activeOptionIndex.value];e.select(r.dataRef.value)}e.mode.value===0&&(e.closeListbox(),J(()=>{var r;return(r=v(e.buttonRef))==null?void 0:r.focus({preventScroll:!0})}));break;case R(e.orientation.value,{vertical:F.ArrowDown,horizontal:F.ArrowRight}):return o.preventDefault(),o.stopPropagation(),e.goToOption(C.Next);case R(e.orientation.value,{vertical:F.ArrowUp,horizontal:F.ArrowLeft}):return o.preventDefault(),o.stopPropagation(),e.goToOption(C.Previous);case F.Home:case F.PageUp:return o.preventDefault(),o.stopPropagation(),e.goToOption(C.First);case F.End:case F.PageDown:return o.preventDefault(),o.stopPropagation(),e.goToOption(C.Last);case F.Escape:o.preventDefault(),o.stopPropagation(),e.closeListbox(),J(()=>{var r;return(r=v(e.buttonRef))==null?void 0:r.focus({preventScroll:!0})});break;case F.Tab:o.preventDefault(),o.stopPropagation();break;default:o.key.length===1&&(e.search(o.key),l.value=setTimeout(()=>e.clearSearch(),350));break}}let g=ye(),h=w(()=>g!==null?(g.value&q.Open)===q.Open:e.listboxState.value===0);return()=>{var o,r,m,_;let k={open:e.listboxState.value===0},{id:O,...L}=t,s={"aria-activedescendant":e.activeOptionIndex.value===null||(o=e.options.value[e.activeOptionIndex.value])==null?void 0:o.id,"aria-multiselectable":e.mode.value===1?!0:void 0,"aria-labelledby":(_=(r=v(e.labelRef))==null?void 0:r.id)!=null?_:(m=v(e.buttonRef))==null?void 0:m.id,"aria-orientation":e.orientation.value,id:O,onKeydown:f,role:"listbox",tabIndex:0,ref:e.optionsRef};return H({ourProps:s,theirProps:L,slot:k,attrs:n,slots:i,features:Z.RenderStrategy|Z.Static,visible:h.value,name:"ListboxOptions"})}}}),pt=$({name:"ListboxOption",props:{as:{type:[Object,String],default:"li"},value:{type:[Object,String,Number,Boolean]},disabled:{type:Boolean,default:!1},id:{type:String,default:()=>`headlessui-listbox.option-${V()}`}},setup(t,{slots:n,attrs:i,expose:u}){let e=oe("ListboxOption"),l=S(null);u({el:l,$el:l});let f=w(()=>e.activeOptionIndex.value!==null?e.options.value[e.activeOptionIndex.value].id===t.id:!1),g=w(()=>R(e.mode.value,{[0]:()=>e.compare(M(e.value.value),M(t.value)),[1]:()=>M(e.value.value).some(s=>e.compare(M(s),M(t.value)))})),h=w(()=>R(e.mode.value,{[1]:()=>{var s;let p=M(e.value.value);return((s=e.options.value.find(a=>p.some(c=>e.compare(M(c),M(a.dataRef.value)))))==null?void 0:s.id)===t.id},[0]:()=>g.value})),o=w(()=>({disabled:t.disabled,value:t.value,textValue:"",domRef:l}));G(()=>{var s,p;let a=(p=(s=v(l))==null?void 0:s.textContent)==null?void 0:p.toLowerCase().trim();a!==void 0&&(o.value.textValue=a)}),G(()=>e.registerOption(t.id,o)),_e(()=>e.unregisterOption(t.id)),G(()=>{me([e.listboxState,g],()=>{e.listboxState.value===0&&g.value&&R(e.mode.value,{[1]:()=>{h.value&&e.goToOption(C.Specific,t.id)},[0]:()=>{e.goToOption(C.Specific,t.id)}})},{immediate:!0})}),ue(()=>{e.listboxState.value===0&&f.value&&e.activationTrigger.value!==0&&J(()=>{var s,p;return(p=(s=v(l))==null?void 0:s.scrollIntoView)==null?void 0:p.call(s,{block:"nearest"})})});function r(s){if(t.disabled)return s.preventDefault();e.select(t.value),e.mode.value===0&&(e.closeListbox(),J(()=>{var p;return(p=v(e.buttonRef))==null?void 0:p.focus({preventScroll:!0})}))}function m(){if(t.disabled)return e.goToOption(C.Nothing);e.goToOption(C.Specific,t.id)}let _=et();function k(s){_.update(s)}function O(s){_.wasMoved(s)&&(t.disabled||f.value||e.goToOption(C.Specific,t.id,0))}function L(s){_.wasMoved(s)&&(t.disabled||f.value&&e.goToOption(C.Nothing))}return()=>{let{disabled:s}=t,p={active:f.value,selected:g.value,disabled:s},{id:a,value:c,disabled:d,...y}=t,P={id:a,ref:l,role:"option",tabIndex:s===!0?void 0:-1,"aria-disabled":s===!0?!0:void 0,"aria-selected":g.value,disabled:void 0,onClick:r,onFocus:m,onPointerenter:k,onMouseenter:k,onPointermove:O,onMousemove:O,onPointerleave:L,onMouseleave:L};return H({ourProps:P,theirProps:y,slot:p,attrs:i,slots:n,name:"ListboxOption"})}}});var vt=(t=>(t[t.Open=0]="Open",t[t.Closed=1]="Closed",t))(vt||{});let Ne=Symbol("PopoverContext");function ve(t){let n=ce(Ne,null);if(n===null){let i=new Error(`<${t} /> is missing a parent <${qe.name} /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(i,ve),i}return n}let Me=Symbol("PopoverGroupContext");function Ve(){return ce(Me,null)}let je=Symbol("PopoverPanelContext");function ft(){return ce(je,null)}let qe=$({name:"Popover",props:{as:{type:[Object,String],default:"div"}},setup(t,{slots:n,attrs:i,expose:u}){var e;let l=S(null);u({el:l,$el:l});let f=S(1),g=S(null),h=S(null),o=S(null),r=S(null),m=w(()=>de(l)),_=w(()=>{var a,c;if(!v(g)||!v(r))return!1;for(let Y of document.querySelectorAll("body > *"))if(Number(Y?.contains(v(g)))^Number(Y?.contains(v(r))))return!0;let d=ke(),y=d.indexOf(v(g)),P=(y+d.length-1)%d.length,E=(y+1)%d.length,N=d[P],X=d[E];return!((a=v(r))!=null&&a.contains(N))&&!((c=v(r))!=null&&c.contains(X))}),k={popoverState:f,buttonId:S(null),panelId:S(null),panel:r,button:g,isPortalled:_,beforePanelSentinel:h,afterPanelSentinel:o,togglePopover(){f.value=R(f.value,{[0]:1,[1]:0})},closePopover(){f.value!==1&&(f.value=1)},close(a){k.closePopover();let c=(()=>a?a instanceof HTMLElement?a:a.value instanceof HTMLElement?v(a):v(k.button):v(k.button))();c?.focus()}};re(Ne,k),Le(w(()=>R(f.value,{[0]:q.Open,[1]:q.Closed})));let O={buttonId:k.buttonId,panelId:k.panelId,close(){k.closePopover()}},L=Ve(),s=L?.registerPopover;function p(){var a,c,d,y;return(y=L?.isFocusWithinPopoverGroup())!=null?y:((a=m.value)==null?void 0:a.activeElement)&&(((c=v(g))==null?void 0:c.contains(m.value.activeElement))||((d=v(r))==null?void 0:d.contains(m.value.activeElement)))}return ue(()=>s?.(O)),Qe((e=m.value)==null?void 0:e.defaultView,"focus",a=>{var c,d;f.value===0&&(p()||g&&r&&a.target!==window&&((c=v(k.beforePanelSentinel))!=null&&c.contains(a.target)||(d=v(k.afterPanelSentinel))!=null&&d.contains(a.target)||k.closePopover()))},!0),Pe([g,r],(a,c)=>{var d;k.closePopover(),Oe(c,Te.Loose)||(a.preventDefault(),(d=v(g))==null||d.focus())},w(()=>f.value===0)),()=>{let a={open:f.value===0,close:k.close};return H({theirProps:t,ourProps:{ref:l},slot:a,slots:n,attrs:i,name:"Popover"})}}}),bt=$({name:"PopoverButton",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1},id:{type:String,default:()=>`headlessui-popover-button-${V()}`}},inheritAttrs:!1,setup(t,{attrs:n,slots:i,expose:u}){let e=ve("PopoverButton"),l=w(()=>de(e.button));u({el:e.button,$el:e.button}),G(()=>{e.buttonId.value=t.id}),_e(()=>{e.buttonId.value=null});let f=Ve(),g=f?.closeOthers,h=ft(),o=w(()=>h===null?!1:h.value===e.panelId.value),r=S(null),m=`headlessui-focus-sentinel-${V()}`;o.value||ue(()=>{e.button.value=r.value});let _=Re(w(()=>({as:t.as,type:n.type})),r);function k(p){var a,c,d,y,P;if(o.value){if(e.popoverState.value===1)return;switch(p.key){case F.Space:case F.Enter:p.preventDefault(),(c=(a=p.target).click)==null||c.call(a),e.closePopover(),(d=v(e.button))==null||d.focus();break}}else switch(p.key){case F.Space:case F.Enter:p.preventDefault(),p.stopPropagation(),e.popoverState.value===1&&g?.(e.buttonId.value),e.togglePopover();break;case F.Escape:if(e.popoverState.value!==0)return g?.(e.buttonId.value);if(!v(e.button)||(y=l.value)!=null&&y.activeElement&&!((P=v(e.button))!=null&&P.contains(l.value.activeElement)))return;p.preventDefault(),p.stopPropagation(),e.closePopover();break}}function O(p){o.value||p.key===F.Space&&p.preventDefault()}function L(p){var a,c;t.disabled||(o.value?(e.closePopover(),(a=v(e.button))==null||a.focus()):(p.preventDefault(),p.stopPropagation(),e.popoverState.value===1&&g?.(e.buttonId.value),e.togglePopover(),(c=v(e.button))==null||c.focus()))}function s(p){p.preventDefault(),p.stopPropagation()}return()=>{let p=e.popoverState.value===0,a={open:p},{id:c,...d}=t,y=o.value?{ref:r,type:_.value,onKeydown:k,onClick:L}:{ref:r,id:c,type:_.value,"aria-expanded":t.disabled?void 0:e.popoverState.value===0,"aria-controls":v(e.panel)?e.panelId.value:void 0,disabled:t.disabled?!0:void 0,onKeydown:k,onKeyup:O,onClick:L,onMousedown:s},P=Fe();function E(){let N=v(e.panel);if(!N)return;function X(){R(P.value,{[Q.Forwards]:()=>K(N,z.First),[Q.Backwards]:()=>K(N,z.Last)})===ge.Error&&K(ke().filter(Y=>Y.dataset.headlessuiFocusGuard!=="true"),R(P.value,{[Q.Forwards]:z.Next,[Q.Backwards]:z.Previous}),{relativeTo:v(e.button)})}X()}return W(ee,[H({ourProps:y,theirProps:{...n,...d},slot:a,attrs:n,slots:i,name:"PopoverButton"}),p&&!o.value&&e.isPortalled.value&&W(se,{id:m,features:ne.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:E})])}}});$({name:"PopoverOverlay",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0}},setup(t,{attrs:n,slots:i}){let u=ve("PopoverOverlay"),e=`headlessui-popover-overlay-${V()}`,l=ye(),f=w(()=>l!==null?(l.value&q.Open)===q.Open:u.popoverState.value===0);function g(){u.closePopover()}return()=>{let h={open:u.popoverState.value===0};return H({ourProps:{id:e,"aria-hidden":!0,onClick:g},theirProps:t,slot:h,attrs:n,slots:i,features:Z.RenderStrategy|Z.Static,visible:f.value,name:"PopoverOverlay"})}}});let gt=$({name:"PopoverPanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},focus:{type:Boolean,default:!1},id:{type:String,default:()=>`headlessui-popover-panel-${V()}`}},inheritAttrs:!1,setup(t,{attrs:n,slots:i,expose:u}){let{focus:e}=t,l=ve("PopoverPanel"),f=w(()=>de(l.panel)),g=`headlessui-focus-sentinel-before-${V()}`,h=`headlessui-focus-sentinel-after-${V()}`;u({el:l.panel,$el:l.panel}),G(()=>{l.panelId.value=t.id}),_e(()=>{l.panelId.value=null}),re(je,l.panelId),ue(()=>{var s,p;if(!e||l.popoverState.value!==0||!l.panel)return;let a=(s=f.value)==null?void 0:s.activeElement;(p=v(l.panel))!=null&&p.contains(a)||K(v(l.panel),z.First)});let o=ye(),r=w(()=>o!==null?(o.value&q.Open)===q.Open:l.popoverState.value===0);function m(s){var p,a;switch(s.key){case F.Escape:if(l.popoverState.value!==0||!v(l.panel)||f.value&&!((p=v(l.panel))!=null&&p.contains(f.value.activeElement)))return;s.preventDefault(),s.stopPropagation(),l.closePopover(),(a=v(l.button))==null||a.focus();break}}function _(s){var p,a,c,d,y;let P=s.relatedTarget;P&&v(l.panel)&&((p=v(l.panel))!=null&&p.contains(P)||(l.closePopover(),((c=(a=v(l.beforePanelSentinel))==null?void 0:a.contains)!=null&&c.call(a,P)||(y=(d=v(l.afterPanelSentinel))==null?void 0:d.contains)!=null&&y.call(d,P))&&P.focus({preventScroll:!0})))}let k=Fe();function O(){let s=v(l.panel);if(!s)return;function p(){R(k.value,{[Q.Forwards]:()=>{var a;K(s,z.First)===ge.Error&&((a=v(l.afterPanelSentinel))==null||a.focus())},[Q.Backwards]:()=>{var a;(a=v(l.button))==null||a.focus({preventScroll:!0})}})}p()}function L(){let s=v(l.panel);if(!s)return;function p(){R(k.value,{[Q.Forwards]:()=>{let a=v(l.button),c=v(l.panel);if(!a)return;let d=ke(),y=d.indexOf(a),P=d.slice(0,y+1),E=[...d.slice(y+1),...P];for(let N of E.slice())if(N.dataset.headlessuiFocusGuard==="true"||c!=null&&c.contains(N)){let X=E.indexOf(N);X!==-1&&E.splice(X,1)}K(E,z.First,{sorted:!1})},[Q.Backwards]:()=>{var a;K(s,z.Previous)===ge.Error&&((a=v(l.button))==null||a.focus())}})}p()}return()=>{let s={open:l.popoverState.value===0,close:l.close},{id:p,focus:a,...c}=t,d={ref:l.panel,id:p,onKeydown:m,onFocusout:e&&l.popoverState.value===0?_:void 0,tabIndex:-1};return H({ourProps:d,theirProps:{...n,...c},attrs:n,slot:s,slots:{...i,default:(...y)=>{var P;return[W(ee,[r.value&&l.isPortalled.value&&W(se,{id:g,ref:l.beforePanelSentinel,features:ne.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:O}),(P=i.default)==null?void 0:P.call(i,...y),r.value&&l.isPortalled.value&&W(se,{id:h,ref:l.afterPanelSentinel,features:ne.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:L})])]}},features:Z.RenderStrategy|Z.Static,visible:r.value,name:"PopoverPanel"})}}});$({name:"PopoverGroup",props:{as:{type:[Object,String],default:"div"}},setup(t,{attrs:n,slots:i,expose:u}){let e=S(null),l=Ge([]),f=w(()=>de(e));u({el:e,$el:e});function g(m){let _=l.value.indexOf(m);_!==-1&&l.value.splice(_,1)}function h(m){return l.value.push(m),()=>{g(m)}}function o(){var m;let _=f.value;if(!_)return!1;let k=_.activeElement;return(m=v(e))!=null&&m.contains(k)?!0:l.value.some(O=>{var L,s;return((L=_.getElementById(O.buttonId.value))==null?void 0:L.contains(k))||((s=_.getElementById(O.panelId.value))==null?void 0:s.contains(k))})}function r(m){for(let _ of l.value)_.buttonId.value!==m&&_.close()}return re(Me,{registerPopover:h,unregisterPopover:g,isFocusWithinPopoverGroup:o,closeOthers:r}),()=>H({ourProps:{ref:e},theirProps:t,slot:{},attrs:n,slots:i,name:"PopoverGroup"})}});const ht={class:"leading-loose"},mt={class:"flex flex-wrap items-center gap-2"},yt=b("div",null,"#",-1),_t=b("div",null,"•",-1),kt=b("div",null,"•",-1),xt=$({__name:"TicketSummary",props:{ticketName:{type:String,required:!0}},setup(t){const n=t,{ticketName:i}=xe(n),u=w(()=>({name:"DeskTicket",params:{ticketId:i.value}})),e=w(()=>o.doc?.subject),l=w(()=>o.getMeta?.data?.message),f=w(()=>l.value?.conversation_count),g=w(()=>l.value?.comment_count),h=w(()=>l.value?.is_seen),o=De({doctype:"HD Ticket",name:i,cache:["Ticket",i],whitelistedMethods:{getMeta:{method:"get_meta",cache:["TicketMetaData",i]}}});return o.getMeta.fetch(),(r,m)=>{const _=B("router-link");return A(),j("div",ht,[x(_,{to:T(u)},{default:I(()=>[b("div",{class:ie(["truncate",{"font-semibold":!T(h)}])},D(T(e)),3)]),_:1},8,["to"]),b("div",mt,[yt,b("div",null,D(T(i)),1),_t,x(T(le),{name:"message-circle",class:"h-4 w-4"}),U(" "+D(T(g))+" ",1),kt,x(T(le),{name:"mail",class:"h-4 w-4"}),U(" "+D(T(f)),1)])])}}}),St={name:"PresetFilters",components:{Dropdown:Ce,FeatherIcon:le},setup(){const t=pe(),n=S([]),i=S("");return{listFilters:t,presetFilters:n,presetTitle:i}},computed:{currentQuery(){return this.$route.query.q},title(){return this.presetTitle?this.presetTitle:this.currentQuery?"Filtered Tickets":"All Tickets"},presets(){return this.$resources.presetFilterOptions.data||[]},options(){let t=[],n=this.presets;return Object.keys(n).length&&Object.keys(n).forEach(i=>{n[i].length&&t.push({group:i==="user"?"My Filters":"Global",hideLabel:i!=="user",items:n[i].map(u=>{const e=this.listFilters.toQuery(u.filters);return e===this.currentQuery&&(this.presetTitle=u.title),{label:u.title,handler:()=>{this.$router.push({query:{q:e}})}}})})}),t}},mounted(){this.$socket.on("frappedesk-preset-filter-insert",t=>{t.reference_doctype==="HD Ticket"&&this.$resources.presetFilterOptions.reload()})},unmounted(){this.$socket.off("frappedesk-preset-filter-insert")},resources:{presetFilterOptions(){return{url:"frappedesk.api.general.get_preset_filters",params:{doctype:"HD Ticket"},cache:["Preset Filter",this.doctype],auto:!0}}}},wt=["onClick"],Pt={class:"text-base"};function Ot(t,n,i,u,e,l){const f=B("FeatherIcon"),g=B("Dropdown");return A(),ae(g,{placement:"left",options:l.options},{default:I(({toggleDropdown:h})=>[b("div",{class:ie(["flex select-none items-center gap-2 rounded-lg border border-gray-300 px-2 py-1",{"cursor-pointer":!t.$_.isEmpty(l.options)}]),onClick:h},[b("div",Pt,D(l.title),1),t.$_.isEmpty(l.options)?he("",!0):(A(),ae(f,{key:0,name:"chevron-down",class:"h-4 w-4 stroke-2"}))],10,wt)]),_:1},8,["options"])}const Tt=Ie(St,[["render",Ot]]),Lt={class:"absolute z-20 pt-2"},Ft={class:"max-h-64 overflow-x-scroll rounded-lg border border-gray-300 bg-white px-1 py-2 shadow-black drop-shadow-xl"},we=$({__name:"FilterCombobox",props:{options:{type:Array,required:!0},defaultSelected:{type:Object,required:!1,default:null},buttonClass:{type:String,required:!1,default:""}},emits:["selection-update"],setup(t,{emit:n}){const i=t,{options:u,defaultSelected:e}=xe(i),l=S(T(e)||[...T(u)].shift());return n("selection-update",l.value),me(l,f=>n("selection-update",f)),(f,g)=>(A(),j("div",null,[x(T(ut),{modelValue:l.value,"onUpdate:modelValue":g[0]||(g[0]=h=>l.value=h)},{default:I(()=>[b("div",null,[x(T(ct),{class:"flex gap-1 rounded-lg bg-gray-200 px-2 py-1"},{default:I(()=>[b("div",{class:ie(["flex content-start truncate",t.buttonClass])},D(l.value.label),3),x(T(le),{name:"chevron-down",class:"h-5 w-5"})]),_:1})]),b("div",Lt,[x(Ee,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:I(()=>[x(T(dt),null,{default:I(()=>[b("div",null,[b("div",Ft,[(A(!0),j(ee,null,Se(T(u),h=>(A(),ae(T(pt),{key:h.value,value:h,class:"bg-white"},{default:I(({active:o})=>[b("div",{class:ie(["cursor-pointer rounded-lg px-2 py-1",o?"bg-gray-200":""])},D(h.label),3)]),_:2},1032,["value"]))),128))])])]),_:1})]),_:1})])]),_:1},8,["modelValue"])]))}}),Dt={class:"flex flex-col gap-2 p-2 text-base"},It={class:"flex items-center justify-between gap-2"},Et={class:"flex justify-between gap-1"},Bt=$({__name:"FilterBox",setup(t){const n=Ke(),i=S([]),u=pe(),e=[{label:"Status",value:"status"},{label:"Assigned To",value:"_assign"},{label:"Priority",value:"priority"}],l=[{value:"=",label:"Equal"},{value:"!=",label:"Not Equal"},{value:">",label:"Greater Than"},{value:">=",label:"Greater Than or Equal"},{value:"<",label:"Less Than"}];function f(){i.value.push({})}function g(r){i.value.splice(r,1),te.isEmpty(i.value)&&h()}function h(){i.value=[],n.push({query:{q:""}})}function o(){const r=i.value.filter(m=>m.fieldname).filter(m=>m.value).filter(m=>m.filter_type);u.applyQuery(u.toQuery(r))}return G(()=>{const r=u.fromQuery();te.isEmpty(r)||(i.value=r)}),(r,m)=>{const _=B("Input"),k=B("Button");return A(),j("div",null,[x(T(qe),null,{default:I(()=>[b("div",null,[x(T(bt),{class:"flex select-none items-center gap-1 rounded-lg border border-gray-300 px-2 py-1 text-base"},{default:I(()=>[x(T(le),{name:"filter",class:"h-3 w-3"}),U(" Filters ")]),_:1})]),x(Ee,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:I(()=>[x(T(gt),{class:"absolute right-2 z-10 m-3 w-max rounded-lg border border-gray-300 bg-white shadow-black drop-shadow-xl"},{default:I(()=>[b("div",Dt,[(A(!0),j(ee,null,Se(i.value,(O,L)=>(A(),j("div",{key:L},[b("div",It,[x(we,{options:e,"default-selected":e.find(s=>s.value===O.fieldname),"button-class":"w-20",onSelectionUpdate:s=>O.fieldname=s.value},null,8,["default-selected","onSelectionUpdate"]),x(we,{options:l,"default-selected":l.find(s=>s.value===O.filter_type),"button-class":"w-12",onSelectionUpdate:s=>O.filter_type=s.value},null,8,["default-selected","onSelectionUpdate"]),x(_,{class:"rounded-lg bg-gray-200",value:O.value,onInput:s=>O.value=s},null,8,["value","onInput"]),x(k,{"icon-left":"x",class:"bg-white hover:bg-white",onClick:()=>g(L)},null,8,["onClick"])])]))),128)),b("div",Et,[x(k,{"icon-left":"plus",class:"rounded-lg bg-white",onClick:f},{default:I(()=>[U("Add Filter")]),_:1}),T(te.isEmpty)(i.value)?he("",!0):(A(),ae(k,{key:0,"icon-left":"check",class:"rounded-lg bg-white",onClick:o},{default:I(()=>[U("Apply Filters")]),_:1})),T(te.isEmpty)(i.value)?he("",!0):(A(),ae(k,{key:1,"icon-left":"x",class:"rounded-lg bg-white",onClick:h},{default:I(()=>[U("Clear Filters")]),_:1}))])])]),_:1})]),_:1})]),_:1})])}}}),At={class:"inline-block align-middle"},Ct={class:"ml-2 inline-block truncate align-middle"},Rt=$({__name:"AssignedInfo",props:{ticketId:{type:String,required:!0}},setup(t){const n=t,{ticketId:i}=xe(n),u=w(()=>f.getAssignees?.data?.message?.pop()),e=w(()=>u.value?.full_name),l=w(()=>u.value?.user_image),f=De({doctype:"HD Ticket",name:i,cache:["Ticket",i],whitelistedMethods:{getAssignees:{method:"get_assignees",cache:["TicketAssignees",i]}}});return f.getAssignees.fetch(),(g,h)=>(A(),j("div",null,[b("div",At,[x(T(at),{size:"sm",label:T(e),"image-u-r-l":T(l)},null,8,["label","image-u-r-l"])]),b("div",Ct,D(T(e)),1)]))}}),$t="frappedesk.extends.client.get_list",Nt="frappedesk.extends.client.get_list_meta";function Mt(t){const n=t.doctype,i=t.fields,u=S(t.filters),e=S(t.orderBy),l=S(t.pageLength),f=S(t.start),g=t.cache,h=pe(),o=Be({type:"list",url:$t,doctype:n,fields:i,orderBy:e,filters:u,pageLength:l.value,start:f.value,cache:g,onSuccess(){r.submit({doctype:n,filters:o.filters,limit:o.pageLength,order_by:o.orderBy,start:o.start})},debug:!0});Object.assign(o,{totalCount:S(0),totalPages:S(0),currentPage:S(0),hasNextPage:S(!1),hasPreviousPage:S(!1),startFrom:S(0),endAt:S(0)});const r=We({url:Nt,onSuccess:m=>{o.totalCount=m.total_count,o.totalPages=m.total_pages,o.currentPage=m.current_page,o.hasNextPage=m.has_next_page,o.hasPreviousPage=m.has_previous_page,o.startFrom=m.start_from,o.endAt=m.end_at},debug:!0});return G(()=>{const m=h.queryFilters(),_=h.queryOrderBy();te.isEmpty(m)||(u.value=m),_&&(e.value=_),o.reload()}),o}const Vt=Ae("ticketStatus",()=>({options:S(["Open","Replied","Resolved","Closed"])})),jt=Ae("ticketPriority",()=>{const t=S([]);Be({doctype:"HD Ticket Priority",auto:!0,onSuccess(u){t.value=u}});function n(){return t.value}function i(){return t.value.map(u=>u.name)}return{getAll:n,getNames:i}}),qt={name:"Tickets",components:{AssignedInfo:Rt,Dropdown:Ce,FilterBox:Bt,NewTicketDialog:Ye,PresetFilters:Tt,TicketSummary:xt},inject:["agents"],setup(){const t=S(new Set),n=pe(),i=Vt(),u=jt(),e=Je(),l=Mt({doctype:"HD Ticket",pageLength:20});return{authStore:e,listFilters:n,selected:t,ticketList:l,ticketPriorityStore:u,ticketStatusStore:i}},data(){function t(u,e){this.$router.push({query:{q:this.$route.query.q,sortBy:u,sortDirection:e}})}const i=[{label:"HD Ticket Type",value:"ticket_type"},{label:"Modified",value:"modified"},{label:"Created",value:"created"}].map(u=>({label:u.label,handler:t.bind(this,u.value,u.sortDirection||"desc")}));return{priorityColorMap:{Urgent:"red",High:"yellow",Medium:"green",Low:"blue"},showNewTicketDialog:!1,sortDropdownOptions:i}},computed:{allSelected(){if(!this.$_.isEmpty(this.ticketList.list.data))return this.ticketList.list.data.length===this.selected.size},filterByPriorityOptions(){return this.ticketPriorityStore.getNames().map(t=>({label:t,handler:()=>this.filterByPriority(t)}))},filterByStatusOptions(){return this.ticketStatusStore.options.map(t=>({label:t,handler:()=>this.filterByStatus(t)}))},agentsAsDropdownOptions(){let t=[];if(this.agents){this.agents.forEach(i=>{t.push({label:i.agent_name,handler:()=>{this.$resources.bulkAssignTicketToAgent.submit({ticket_ids:Array.from(this.selected),agent_id:i.name})}})});let n=[];return this.authStore.isAgent&&n.push({group:"Myself",hideLabel:!0,items:[{label:"Assign to me",handler:()=>{this.$resources.bulkAssignTicketToAgent.submit({ticket_ids:Array.from(this.selected),agent_id:this.authStore.userId})}}]}),n.push({group:"All Agents",hideLabel:!0,items:t}),n}else return null}},methods:{toggleOne(t,n){n?this.selected.add(t):this.selected.delete(t)},selectAll(){this.ticketList.list.data.forEach(t=>this.selected.add(t.name))},deselectAll(){this.selected.clear()},toggleAllSelected(t){t?this.selectAll():this.deselectAll()},setTicketStatus(t,n){this.ticketList.setValue.submit({name:t,status:n})},statusDropdownOptions(t,n){return this.ticketStatusStore.options.filter(i=>i!==n).map(i=>({label:i,handler:()=>this.setTicketStatus(t,i)}))},filterByPriority(t){this.filterByField("priority",t)},filterByStatus(t){this.filterByField("status",t)},filterByField(t,n){const i=[{fieldname:t,filter_type:"is",value:n}];this.listFilters.applyQuery(this.listFilters.toQuery(i))}},resources:{bulkAssignTicketStatus(){return{url:"frappedesk.api.ticket.bulk_assign_ticket_status",onSuccess:t=>{this.$refs.ticketList.manager.selectedItems=[],this.$refs.ticketList.manager.reload(),this.$toast({title:`Tickets marked as ${t.status}.`,icon:"check",iconClasses:"text-green-500"}),this.$event.emit("update_ticket_list")},onError:()=>{this.$toast({title:"Unable to mark tickets as closed.",icon:"x",iconClasses:"text-red-500"})}}},bulkAssignTicketToAgent(){return{url:"frappedesk.api.ticket.bulk_assign_ticket_to_agent",onSuccess:()=>{this.$toast({title:"Tickets assigned to agent",icon:"check",iconClasses:"text-green-500"})},onError:()=>{this.$toast({title:"Unable to assign tickets to agent.",icon:"x",iconClasses:"text-red-500"})}}}}},Ht={class:"flex flex-col text-gray-700"},Ut={class:"flex justify-between px-6 pt-6 pb-2 text-gray-900"},zt=b("div",{class:"text-2xl font-semibold"},"Tickets",-1),Qt={class:"flex justify-between px-6 py-3"},Gt={class:"flex gap-2"},Kt={class:"flex items-center gap-2"},Wt={class:"px-6 font-sans text-base text-gray-500"},Jt={class:"flex items-center border-y border-gray-300 p-2"},Xt={class:"pl-1 pr-4"},Yt=Xe('<div class="basis-1/3">Summary</div><div class="flex basis-2/3"><div class="basis-1/5">Assigned To</div><div class="basis-1/5">Raised By</div><div class="basis-1/5">Type</div><div class="basis-1/5">Status</div><div class="basis-1/5">Priority</div></div>',2),Zt={class:"overflow-x-scroll px-6 py-2 font-sans text-base"},el={class:"pl-1 pr-4"},tl={class:"basis-1/3 w-1/12 pr-8"},ll={class:"flex basis-2/3 items-center"},al={class:"basis-1/5"},ol={class:"basis-1/5"},sl={class:"truncate"},nl={class:"basis-1/5"},il={class:"basis-1/5"},rl={class:"basis-1/5"},ul=b("div",{class:"grow"},null,-1),cl={class:"flex justify-between border-t p-4 font-sans text-base"},dl={class:"text-gray-700"},pl={class:"flex items-center gap-2"},vl={class:"flex h-5 w-5 flex-wrap content-center justify-center rounded-md bg-gray-200"},fl={class:"fixed inset-x-0 bottom-8 mx-auto w-max font-sans text-base"},bl={class:"shadow-around flex items-center rounded-lg border border-gray-300 bg-white px-3 py-2"},gl={class:"w-64"},hl={class:"inline-block align-middle"},ml={class:"inline-block pl-2 align-middle"},yl=b("div",{class:"text-gray-300"},"|",-1);function _l(t,n,i,u,e,l){const f=B("Button"),g=B("PresetFilters"),h=B("Dropdown"),o=B("FilterBox"),r=B("Input"),m=B("TicketSummary"),_=B("AssignedInfo"),k=B("Tooltip"),O=B("Badge"),L=B("NewTicketDialog");return A(),j("div",Ht,[b("div",Ut,[zt,b("div",null,[x(f,{"icon-left":"plus",onClick:n[0]||(n[0]=s=>e.showNewTicketDialog=!0)},{default:I(()=>[U(" Add Ticket ")]),_:1})])]),b("div",Qt,[b("div",Gt,[x(g,{doctype:"HD Ticket"}),x(h,{options:l.filterByStatusOptions,button:{label:"Status",iconRight:"chevron-down",class:"text-gray-500 bg-gray-200 rounded-lg"}},null,8,["options"]),x(h,{options:l.filterByPriorityOptions,button:{label:"Priority",iconRight:"chevron-down",class:"text-gray-500 bg-gray-200 rounded-lg"}},null,8,["options"])]),b("div",Kt,[x(o,{doctype:"HD Ticket"}),x(h,{options:e.sortDropdownOptions,button:{label:"Sort",iconLeft:"list",class:"text-gray-500 bg-gray-200 rounded-lg"}},null,8,["options"])])]),b("div",Wt,[b("div",Jt,[b("div",Xt,[x(r,{type:"checkbox","input-class":"cursor-pointer",value:l.allSelected,onchange:s=>l.toggleAllSelected(s.target.checked)},null,8,["value","onchange"])]),Yt])]),b("div",Zt,[(A(!0),j(ee,null,Se(u.ticketList.list.data,s=>(A(),j("div",{key:s.name,class:"hover:shadow-around flex w-full items-center rounded-lg border-b p-2 shadow-black transition-all last-of-type:border-none"},[b("div",el,[x(r,{type:"checkbox","input-class":"cursor-pointer",value:u.selected.has(s.name),onchange:p=>l.toggleOne(s.name,p.target.checked)},null,8,["value","onchange"])]),b("div",tl,[x(m,{"ticket-name":s.name},null,8,["ticket-name"])]),b("div",ll,[b("div",al,[x(_,{"ticket-id":s.name},null,8,["ticket-id"])]),b("div",ol,[x(k,{text:s.raised_by},{default:I(()=>[b("div",sl,D(s.contact),1)]),_:2},1032,["text"])]),b("div",nl,D(s.ticket_type),1),b("div",il,[x(h,{options:l.statusDropdownOptions(s.name,s.status),button:{label:s.status,iconRight:"chevron-down",class:"bg-white text-gray-500 hover:bg-white"}},null,8,["options","button"])]),b("div",rl,[x(O,{"color-map":e.priorityColorMap,label:s.priority},null,8,["color-map","label"])])])]))),128))]),ul,b("div",cl,[b("div",dl," Showing "+D(u.ticketList.startFrom)+" to "+D(u.ticketList.endAt)+" of "+D(u.ticketList.totalCount),1),b("div",pl,[U(" Page "),b("div",vl,D(u.ticketList.currentPage),1),U(" of "+D(u.ticketList.totalPages)+" ",1),fe(x(f,{icon:"chevron-left",class:"h-5 w-5 rounded-full bg-gray-200",onClick:u.ticketList.previous},null,8,["onClick"]),[[be,u.ticketList.hasPreviousPage]]),fe(x(f,{icon:"chevron-right",class:"h-5 w-5 rounded-full bg-gray-200",onClick:u.ticketList.next},null,8,["onClick"]),[[be,u.ticketList.hasNextPage]])])]),fe(b("div",fl,[b("div",bl,[b("div",gl,[b("div",hl,[x(r,{type:"checkbox",value:!0,disabled:!0})]),b("div",ml,D(u.selected.size)+" tickets selected ",1)]),b("div",null,[x(h,{options:l.agentsAsDropdownOptions,button:{label:"Assign",iconLeft:"plus-circle",class:"bg-white text-gray-500"}},null,8,["options"])]),yl,b("div",null,[x(f,{label:"Select all",class:"bg-white text-gray-500",disabled:l.allSelected,onClick:l.selectAll},null,8,["disabled","onClick"])]),b("div",null,[x(f,{icon:"x",class:"bg-white text-gray-500",onClick:l.deselectAll},null,8,["onClick"])])])],512),[[be,u.selected.size]]),x(L,{modelValue:e.showNewTicketDialog,"onUpdate:modelValue":n[1]||(n[1]=s=>e.showNewTicketDialog=s),onClose:n[2]||(n[2]=s=>e.showNewTicketDialog=!1),onTicketCreated:n[3]||(n[3]=()=>{e.showNewTicketDialog=!1})},null,8,["modelValue"])])}const Bl=Ie(qt,[["render",_l]]);export{Bl as default};
