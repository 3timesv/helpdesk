import{_ as k,p as a,M as v,o as y,d as x,i as r,w as f,b as s,k as E,v as V,r as l}from"./index-d9377e3a.js";import{E as T}from"./ErrorMessage-e4ff6432.js";import{T as j,a as I}from"./TextEditor-b1ee2b34.js";import{A as M}from"./Autocomplete-c752a27e.js";const w={name:"NewTicketDialog",components:{TextEditor:j,TextEditorFixedMenu:I,Autocomplete:M,ErrorMessage:T},props:{modelValue:{type:Boolean,required:!0},fdCustomer:{type:String,default:null}},setup(t,{emit:o}){const p=a(!1),n=a(""),c=a(""),m=a(""),h=a(""),d=a(""),u=a("");let C=v({get:()=>t.modelValue,set:g=>{o("update:modelValue",g),g||o("close")}});const b=V("ticketController");return{isCreating:p,selectedContact:n,selectedTicketType:c,contactValidationError:m,subjectValidationError:h,descriptionValidationError:d,open:C,ticketController:b,selectedCustomer:u}},data(){return{subject:"",descriptionContent:""}},computed:{textEditorMenuButtons(){return["Paragraph",["Heading 2","Heading 3","Heading 4","Heading 5","Heading 6"],"Separator","Bold","Italic","Separator","Bullet List","Numbered List","Separator","Align Left","Align Center","Align Right","Separator","Image","Link","Blockquote","Code","Horizontal Rule",["InsertTable","AddColumnBefore","AddColumnAfter","DeleteColumn","AddRowBefore","AddRowAfter","DeleteRow","MergeCells","SplitCell","ToggleHeaderColumn","ToggleHeaderRow","ToggleHeaderCell","DeleteTable"],"Separator"]}},watch:{selectedContact(t){this.validateContactInput(t)},subject(t){this.validateSubjectInput(t)},descriptionContent(t){this.validateDescriptionInput(t)}},methods:{createTicket(){this.validateInputs()||(this.isCreating=!0,this.ticketController.new("ticket",{contact:this.selectedContact,subject:this.subject,ticket_type:this.selectedTicketType,description:this.descriptionContent,customer:this.fdCustomer!=null?this.fdCustomer:this.selectedCustomer}).then(()=>{this.isCreating=!1,this.$emit("ticket-created")}).catch(()=>this.isCreating=!1))},validateInputs(){let t=this.validateContactInput(this.selectedContact);return t+=this.validateSubjectInput(this.subject),t+=this.validateDescriptionInput(this.descriptionContent),t},validateContactInput(t){return this.contactValidationError="",t?t.trim()==""&&(this.contactValidationError="Contact should not be empty"):this.contactValidationError="Contact should not be empty",this.contactValidationError},validateSubjectInput(t){return this.subjectValidationError="",t?t.trim()==""?this.subjectValidationError="Subject should not be empty":t.length<=2&&(this.subjectValidationError="Subject should be longer than that"):this.subjectValidationError="Subject should not be empty",this.subjectValidationError},validateDescriptionInput(t){return this.descriptionValidationError="",t?["<p><br></p>","<p></p>"].includes(t.replaceAll(" ",""))&&(this.descriptionValidationError="Description should not be empty"):this.descriptionValidationError="Description should not be empty",this.subjectValidationError}}},A={class:"space-y-4"},B={class:"space-y-1"},D={class:"w-full space-y-1"},S=s("div",null,[s("span",{class:"mb-2 block text-sm leading-4 text-gray-700"}," Ticket Type ")],-1),H={class:"w-full space-y-1"},N=s("div",null,[s("span",{class:"mb-2 block text-sm leading-4 text-gray-700"}," Created By ")],-1),R={class:"w-full space-y-1"},L=s("div",null,[s("span",{class:"mb-2 block text-sm leading-4 text-gray-700"}," Customer ")],-1),F={class:"space-y-1"},q=s("span",{class:"mb-2 block text-sm leading-4 text-gray-700"}," Description ",-1),U={class:"float-right flex space-x-2"};function z(t,o,p,n,c,m){const h=l("Input"),d=l("ErrorMessage"),u=l("Autocomplete"),C=l("TextEditorFixedMenu"),b=l("TextEditor"),g=l("Button"),_=l("Dialog");return y(),x("div",null,[r(_,{modelValue:n.open,"onUpdate:modelValue":o[6]||(o[6]=e=>n.open=e),options:{title:"Create New Ticket"}},{"body-content":f(()=>[s("div",A,[s("div",B,[r(h,{modelValue:c.subject,"onUpdate:modelValue":o[0]||(o[0]=e=>c.subject=e),label:"Subject",type:"text"},null,8,["modelValue"]),r(d,{message:n.subjectValidationError},null,8,["message"])]),s("div",D,[S,r(u,{value:n.selectedTicketType,"resource-options":{url:"frappedesk.extends.client.get_list",inputMap:e=>({doctype:"Ticket Type",pluck:"name",filters:[["name","like",`%${e}%`]]}),responseMap:e=>e.map(i=>({label:i.name,value:i.name}))},onChange:o[1]||(o[1]=e=>{e&&(n.selectedTicketType=e.value)})},null,8,["value","resource-options"])]),s("div",H,[N,r(u,{value:n.selectedContact,"resource-options":{url:"frappedesk.extends.client.get_list",inputMap:e=>({doctype:"Contact",pluck:"name",filters:[["name","like",`%${e}%`]]}),responseMap:e=>e.map(i=>({label:i.name,value:i.name}))},onChange:o[2]||(o[2]=e=>{e&&(n.selectedContact=e.value,n.selectedCustomer=n.selectedContact.split("-")[1])})},null,8,["value","resource-options"]),r(d,{message:n.contactValidationError},null,8,["message"])]),s("div",R,[L,r(u,{value:p.fdCustomer!=null?p.fdCustomer:n.selectedCustomer,"resource-options":{url:"frappedesk.extends.client.get_list",inputMap:e=>({doctype:"HD Customer",pluck:"name",filters:[["name","like",`%${e}%`]]}),responseMap:e=>e.map(i=>({label:i.name,value:i.name}))},onChange:o[3]||(o[3]=e=>{e&&(n.selectedCustomer=e.value)})},null,8,["value","resource-options"])]),s("div",F,[s("div",null,[q,r(b,{ref:"textEditor",class:"rounded border","editor-class":"px-2 min-h-[8rem] overflow-y-auto max-h-[15vh]",content:c.descriptionContent,"starterkit-options":{heading:{levels:[2,3,4,5,6]}},editable:!0,onChange:o[4]||(o[4]=e=>{c.descriptionContent=e})},{top:f(()=>[r(C,{buttons:m.textEditorMenuButtons,class:"bg-gray-100"},null,8,["buttons"])]),_:1},8,["content"])]),r(d,{message:n.descriptionValidationError},null,8,["message"])]),s("div",U,[r(g,{appearance:"primary",loading:n.isCreating,onClick:o[5]||(o[5]=e=>m.createTicket())},{default:f(()=>[E(" Create ")]),_:1},8,["loading"])])])]),_:1},8,["modelValue"])])}const O=k(w,[["render",z]]);export{O as N};
