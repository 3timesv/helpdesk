import{L as S}from"./LoginBox-70243d97.js";import{_ as b,I as M,u as L,p as r,c as d,w as a,r as n,o as i,b as s,i as p,m as w,k as u,d as V,F as v,q as B,t as P}from"./index-d9377e3a.js";import"./CustomIcons-60888788.js";const q={name:"Login",props:{forgot:{default:!1}},components:{LoginBox:S,Input:M},setup(){const m=L(),t=r(null),o=r(null),e=r(null),f=r(null),l=r(null),g=r(null);return{authStore:m,state:t,email:o,password:e,errorMessage:f,successMessage:l,redirect_route:g}},watch:{forgot(){this.errorMessage=null,this.state=null,this.password=null,this.successMessage=null}},async mounted(){this.$route?.query?.route&&(this.redirect_route=this.$route.query.route),this.authStore.isLoggedIn&&this.redirect()},methods:{async loginOrResetPassword(){try{this.errorMessage=null,this.state="RequestStarted",this.forgot?await this.resetPassword():await this.login()}catch(m){this.errorMessage=m.messages.join(`
`)}finally{this.state=null}},async login(){this.email&&this.password&&(await this.authStore.login(this.email,this.password),this.redirect())},async resetPassword(){await this.authStore.resetPassword(this.email),this.successMessage=!0},redirect(){this.redirect_route?window.location.href=this.redirect_route:window.location.href=this.$route.name=="DeskLogin"?"/frappedesk/tickets":"/support/tickets"}}},C={class:"mt-2 text-sm"},I=s("div",{class:"mt-10 border-t text-center"},[s("div",{class:"-translate-y-1/2 transform"},[s("span",{class:"bg-white px-2 text-xs uppercase leading-8 tracking-wider text-gray-800"}," Or ")])],-1),R=s("div",null,"Sign up for a new account",-1),E={class:"font-semibold"};function N(m,t,o,e,f,l){const g=n("Input"),h=n("router-link"),_=n("ErrorMessage"),y=n("Button"),k=n("LoginBox"),x=n("SuccessCard");return e.successMessage?(i(),d(x,{key:1,class:"mx-auto mt-20",title:"Password Reset Link Sent."},{default:a(()=>[u(" We have sent an email to "),s("span",E,P(e.email),1),u(". Please click on the link received to reset your password. ")]),_:1})):(i(),d(k,{key:0,title:o.forgot?"Reset your password":"Log in to your account"},{default:a(()=>[s("form",{class:"space-y-4",onSubmit:t[2]||(t[2]=B((...c)=>l.login&&l.login(...c),["prevent"]))},[p(g,{required:"",label:"Email",type:e.email!=="Administrator"?"email":"text",modelValue:e.email,"onUpdate:modelValue":t[0]||(t[0]=c=>e.email=c),placeholder:"johndeo@gmail.com"},null,8,["type","modelValue"]),o.forgot?w("",!0):(i(),d(g,{key:0,label:"Password",type:"password",placeholder:"•••••",modelValue:e.password,"onUpdate:modelValue":t[1]||(t[1]=c=>e.password=c),name:"password",autocomplete:"current-password",required:""},null,8,["modelValue"])),s("div",C,[o.forgot?(i(),d(h,{key:0,to:"/login"},{default:a(()=>[u(" I remember my password ")]),_:1})):(i(),d(h,{key:1,to:"/login/forgot"},{default:a(()=>[u(" Forgot Password ")]),_:1}))]),p(_,{error:e.errorMessage,class:"mt-4"},null,8,["error"]),p(y,{appearance:"primary",class:"w-full",disabled:e.state==="RequestStarted",onClick:l.loginOrResetPassword,type:"primary"},{default:a(()=>[u(" Submit ")]),_:1},8,["disabled","onClick"]),s("div",null,[o.forgot?w("",!0):(i(),V(v,{key:0},[I,p(h,{class:"text-center text-base",to:`${this.$route.name==="DeskLogin"?"/frappedesk":"/support"}/signup`},{default:a(()=>[R]),_:1},8,["to"])],64))])],32)]),_:1},8,["title"]))}const j=b(q,[["render",N]]);export{j as default};
