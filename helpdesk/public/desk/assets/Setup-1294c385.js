import{C as I}from"./CustomIcons-60888788.js";import{I as C}from"./Images-cb3ddf70.js";import{_ as A,s as B,L as F,p,d as l,b as e,i as m,q as y,F as L,e as P,m as c,x as b,y as v,t as x,w,h as E,c as D,k as _,r as d,o,z as M,A as O}from"./index-d9377e3a.js";const N={name:"DeskSetup",components:{CustomIcons:I,FeatherIcon:B,Images:C,LoadingIndicator:F},setup(){const a=p(1),s=p(2),h=p(!1),t=p(!0),u={GMail:{email_server:"imap.gmail.com",use_ssl:1,smtp_server:"smtp.gmail.com"},"Outlook.com":{email_server:"imap-mail.outlook.com",use_ssl:1,smtp_server:"smtp-mail.outlook.com"},Sendgrid:{smtp_server:"smtp.sendgrid.net"},SparkPost:{smtp_server:"smtp.sparkpostmail.com"},"Yahoo Mail":{email_server:"imap.mail.yahoo.com",use_ssl:1,smtp_server:"smtp.mail.yahoo.com"},Others:{use_ssl:1}},r=p([{title:"GMail",image:"gmail",name:"GMail",selected:!0},{title:"Outlook",image:"outlook",name:"Outlook.com"},{title:"Yahoo Mail",image:"yahoo",name:"Yahoo Mail"},{title:"Others",name:"Others"}]),g=p({service:r.value[0].name,email:"",password:"",agentEmailsStr:"",agentEmailList:[]}),f=p({});return{emailDefaults:u,submitInProgress:h,emailAccountCreationSkipped:t,currentStep:a,totalSteps:s,services:r,inputValues:g,errors:f}},mounted(){this.$event.on("email-account-created",()=>{this.inputValues.agentEmailList.length>0&&this.$resources.sentInvites.submit({emails:this.inputValues.agentEmailList,send_welcome_mail_to_user:!0}),this.$resources.completeSetup.submit()}),this.$event.on("email-account-creation-failed",a=>{this.$toast({title:"Email account creation failed",text:a,icon:"x",iconClasses:"text-red-500"}),this.submitInProgress=!1})},methods:{createEmailAccount(){this.submitInProgress=!0,this.$resources.createEmailAccount.submit({doc:{doctype:"Email Account",email_account_name:"Support",email_id:this.inputValues.email,password:this.inputValues.password,enable_incoming:1,enable_outgoing:1,default_incoming:0,default_outgoing:1,email_sync_option:"UNSEEN",initial_sync_count:100,imap_folder:[{append_to:"HD Ticket",folder_name:"INBOX"}],create_contact:!0,track_email_status:!0,service:this.inputValues.service!="Others"?this.inputValues.service:"",use_tls:1,use_imap:1,smtp_port:587,...this.emailDefaults[this.inputValues.service]}})},submitStep(){this.validateInputs(this.currentStep)&&(this.currentStep==1&&(this.emailAccountCreationSkipped=!1),this.currentStep<this.totalSteps?this.currentStep++:this.emailAccountCreationSkipped?this.inputValues.agentEmailList.length>0&&this.$resources.sentInvites.submit({emails:this.inputValues.agentEmailList,send_welcome_mail_to_user:!1}).then(()=>{this.$resources.completeSetup.submit()}):this.createEmailAccount())},skip(){this.currentStep==1&&(this.emailAccountCreationSkipped=!0),this.currentStep==this.totalSteps&&(this.emailAccountCreationSkipped?this.$resources.completeSetup.submit():this.createEmailAccount()),this.currentStep<this.totalSteps&&this.currentStep++},goBack(){this.currentStep>1&&this.currentStep--},selectService(a){this.services.forEach(s=>{s.selected=!1}),a.selected=!0,this.inputValues.service=a.name},validateInputs(a){this.errors={};const s=t=>/^\w+@[a-zA-Z_]+?\.[a-zA-Z]{2,3}$/.test(t),h=t=>/^(?=.*\d)(?=.*[a-z]).{6,20}$/.test(t);switch(a){case 1:this.inputValues.email?s(this.inputValues.email)||(this.errors.email="Please enter a valid email address"):this.errors.email="Email is required",this.inputValues.password?h(this.inputValues.password)||(this.errors.password="Password must be at least 6 characters long and contain at least one number and one letter"):this.errors.password="Password is required",this.inputValues.service||(this.errors.service="Service is required");break;case 2:if(this.inputValues.agentEmailList=[],this.inputValues.agentEmailsStr.replaceAll(" ","")!=""){let t=this.inputValues.agentEmailsStr.replaceAll(" ","").split(",");t.forEach(u=>{s(u)||(this.errors.agentEmailsStr="Please enter a valid email address")}),this.inputValues.agentEmailList=t}else this.errors.agentEmailsStr="Please enter at least one email address";break}return Object.keys(this.errors).length===0}},resources:{createEmailAccount(){return{url:"frappe.client.insert",onSuccess:()=>{this.$event.emit("email-account-created")},onError:a=>{this.$event.emit("email-account-creation-failed",a)}}},sentInvites(){return{url:"frappedesk.api.agent.sent_invites",onSuccess:()=>{this.$event.emit("sent-invites-success")},onError:a=>{this.$event.emit("sent-invites-failed",a)}}},completeSetup(){return{url:"frappe.client.set_value",params:{doctype:"HD Settings",name:"HD Settings",fieldname:"setup_complete",value:1},onSuccess:()=>{this.$toast({title:"Setup Complete",icon:"check",iconClasses:"text-green-500"}),this.submitInProgress=!1,this.$router.push({name:"DeskTickets"})},onError:a=>{this.$toast({title:"Setup Failed",text:a,icon:"x",iconClasses:"text-red-500"}),this.submitInProgress=!1}}}}},n=a=>(M("data-v-28454895"),a=a(),O(),a),R={class:"w-screen bg-[#F3F5F8]",style:{"min-height":"100vh"}},j={class:"md:p-[0px] lg:p-[80px]"},z={class:"bg-white sm:h-[100hv] sm:rounded-none lg:rounded-[10px]",style:{"{\n						box-shadow":"0px 1px 42px rgba(97, 97, 97, 0.07)","min-height":"calc(100vh - 160px)"}},G={class:"flex justify-center py-[60px] sm:px-[10px] lg:px-[0px]"},T={class:"flex w-[370px] flex-col space-y-[60px]"},q={class:"flex justify-center"},U=n(()=>e("div",{class:"mb-[10px] text-[24px] font-bold text-gray-900"}," Welcome to FrappeDesk ",-1)),H=n(()=>e("div",{class:"mb-[30px] text-[16px] font-normal text-gray-600"}," Thanks for verifying your e-mail. ",-1)),Y=n(()=>e("div",{class:"mb-[30px] text-[16px] font-normal text-gray-900"}," Configure your e-mail address to start sending and receiving e-mails into FrappeDesk. ",-1)),Z={class:"mb-[30px]"},W=n(()=>e("span",{class:"mb-2 block text-sm leading-4 text-gray-700"}," Service ",-1)),X={class:"mx-[-4px] flex flex-wrap text-[11px] text-gray-700"},J=["onClick"],K={key:0,class:"mb-[30px] flex flex-row items-center space-x-4 rounded border-2 border-blue-500 bg-blue-50 p-3 text-base text-gray-700"},Q=n(()=>e("p",null,[_(" GMail will only work if you enable 2-step authentication and use app-specific password. "),e("a",{href:"https://docs.erpnext.com/docs/v13/user/manual/en/setting-up/email/email_account_setup_with_gmail",target:"_blank",class:"text-blue-500 hover:underline"},"Read the step by step guide here.")],-1)),$={class:"mb-[30px] flex flex-col space-y-[10px]"},ee=n(()=>e("span",{class:"mb-2 block text-sm leading-4 text-gray-700"}," E-mail ID ",-1)),te={key:0,class:"text-base font-normal text-red-500"},se={class:"mb-[30px] flex flex-col space-y-[10px]"},ae=n(()=>e("span",{class:"mb-2 block text-sm leading-4 text-gray-700"}," Password ",-1)),ie={key:0,class:"text-base font-normal text-red-500"},re={class:"flex justify-center pl-[15px]"},oe=n(()=>e("span",null," Skip Onboarding ",-1)),le={class:"h-[15px]"},ne=n(()=>e("div",{class:"mb-[30px] text-[24px] font-bold text-gray-900"}," Let’s invite your teammates ",-1)),ce={key:0,class:"mb-[30px] flex flex-row items-center space-x-4 rounded border-2 border-yellow-300 bg-yellow-50 p-3 text-base text-gray-700"},pe={class:"mb-[30px] flex flex-col space-y-[10px]"},ue=n(()=>e("span",{class:"mb-2 block text-sm leading-4 text-gray-700"}," E-mail IDs (comma-separated) ",-1)),me={key:0,class:"text-base font-normal text-red-500"},de={class:"mb-[30px] flex justify-center"};function he(a,s,h,t,u,r){const g=d("CustomIcons"),f=d("Images"),k=d("FeatherIcon"),S=d("Button"),V=d("LoadingIndicator");return o(),l("div",R,[e("div",j,[e("div",z,[e("div",G,[e("div",T,[e("div",q,[m(g,{name:"frappedesk",class:"h-[24px]"})]),e("div",null,[t.currentStep==1?(o(),l("form",{key:0,onSubmit:s[3]||(s[3]=y((...i)=>r.submitStep&&r.submitStep(...i),["prevent"]))},[U,H,Y,e("div",Z,[W,e("div",X,[(o(!0),l(L,null,P(t.services,i=>(o(),l("div",{key:i.title,role:"button",class:E(["m-1 flex h-[80px] w-[80px] flex-col items-center space-y-2 rounded border p-1.5 hover:shadow-sm",i.selected?"border-2 border-blue-500 bg-blue-50":"bg-white"]),onClick:xe=>r.selectService(i)},[m(f,{name:i.image,class:"h-10 w-10"},null,8,["name"]),e("div",null,x(i.title),1)],10,J))),128))])]),t.inputValues.service=="GMail"?(o(),l("div",K,[m(k,{name:"info",class:"h-6 w-6 shrink-0 stroke-blue-500 stroke-2"}),Q])):c("",!0),e("label",$,[ee,e("div",null,[b(e("input",{"onUpdate:modelValue":s[0]||(s[0]=i=>t.inputValues.email=i),type:"text",class:"h-[36px] w-full rounded-[6px] border-[#EBEEF0]"},null,512),[[v,t.inputValues.email]]),t.errors.email?(o(),l("span",te,x(t.errors.email),1)):c("",!0)])]),e("label",se,[ae,e("div",null,[b(e("input",{"onUpdate:modelValue":s[1]||(s[1]=i=>t.inputValues.password=i),type:"password",class:"h-[36px] w-full rounded-[6px] border-[#EBEEF0]"},null,512),[[v,t.inputValues.password]]),t.errors.password?(o(),l("span",ie,x(t.errors.password),1)):c("",!0)])]),m(S,{appearance:"primary",class:"mb-[14px] w-full"},{default:w(()=>[_("Next")]),_:1}),e("div",re,[e("div",{class:E(["flex flex-row items-center space-x-3 text-center text-base font-normal text-gray-600 hover:text-gray-700",a.$resources.completeSetup.loading?"text-gray-500 hover:text-gray-500 cursor-wait":"cursor-pointer"]),onClick:s[2]||(s[2]=i=>a.$resources.completeSetup.submit())},[oe,e("div",le,[a.$resources.completeSetup.loading?(o(),D(V,{key:0})):c("",!0)])],2)])],32)):c("",!0),t.currentStep==2?(o(),l("form",{key:1,onSubmit:s[8]||(s[8]=y((...i)=>r.submitStep&&r.submitStep(...i),["prevent"]))},[ne,t.emailAccountCreationSkipped?(o(),l("div",ce,[m(k,{name:"alert-triangle",class:"h-6 w-6 shrink-0 stroke-yellow-500 stroke-2"}),e("p",null,[_(" Invitation emails will only be sent once email account is setup up, "),e("span",{class:"text-blue-500 hover:underline",role:"button",onClick:s[4]||(s[4]=(...i)=>r.goBack&&r.goBack(...i))},"setup up now")])])):c("",!0),e("label",pe,[ue,e("div",null,[b(e("textarea",{"onUpdate:modelValue":s[5]||(s[5]=i=>t.inputValues.agentEmailsStr=i),rows:"3",class:"max-h-[130px] min-h-[80px] w-full rounded-[6px] border-[#EBEEF0] text-[16px] font-normal placeholder:text-gray-400",placeholder:"tom@frappe.io, alex@frappe.io, joe@frappe.io"},null,512),[[v,t.inputValues.agentEmailsStr]]),t.errors.agentEmailsStr?(o(),l("span",me,x(t.errors.agentEmailsStr),1)):c("",!0)])]),m(S,{loading:t.submitInProgress,appearance:"primary",class:"mb-[14px] w-full"},{default:w(()=>[_("Finish")]),_:1},8,["loading"]),e("div",de,[e("div",{class:"text-center text-base font-normal text-gray-600 hover:text-gray-700",role:"button",onClick:s[6]||(s[6]=(...i)=>r.skip&&r.skip(...i))}," I’ll do this later ")]),e("div",{class:"max-w-fit text-base font-normal text-gray-600 hover:text-gray-700",role:"button",onClick:s[7]||(s[7]=(...i)=>r.goBack&&r.goBack(...i))}," ← Back ")],32)):c("",!0)])])])])])])}const be=A(N,[["render",he],["__scopeId","data-v-28454895"]]);export{be as default};
