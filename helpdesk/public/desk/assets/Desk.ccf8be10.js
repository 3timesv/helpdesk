var v=(t,s,r)=>new Promise((_,h)=>{var u=n=>{try{i(r.next(n))}catch(a){h(a)}},c=n=>{try{i(r.throw(n))}catch(a){h(a)}},i=n=>n.done?_(n.value):Promise.resolve(n.value).then(u,c);i((r=r.apply(t,s)).next())});import{_ as g,A as b,i as y,D as T,j as C,r as p,o as d,k,l as e,m as o,w as l,t as f,n as $,b as m,p as S,d as A,K as x}from"./vendor.1fecb205.js";import{C as w}from"./CustomIcons.a0211f21.js";const B={name:"NavBar",components:{Avatar:b,FeatherIcon:y,CustomIcons:w,Dropdown:T},methods:{ticketFilterDropdownOptions(){let t=[];return["All Tickets","Assigned to me"].forEach(s=>{t.push({label:s,handler:()=>{console.log(this.$user),this.$ticketFilter.set(s)}})}),t},contactFilterDropdownOptions(){let t=[];return["All Contacts"].forEach(s=>{t.push({label:s,handler:()=>{console.log(this.$user),this.$contactFilter.set(s)}})}),t},getAvatarClickOptions(){let t=[];return["Logout"].forEach(s=>{t.push({label:s,handler:()=>{this.logout()}})}),t},logout(){return v(this,null,function*(){yield C("logout"),window.location.replace("/login")})}}},D={class:"flow-root pb-3 pt-4 pl-5 pr-8 border-b"},F={class:"float-left"},I={key:0},j=["onClick"],N={class:"text-2xl"},O={key:1},W=["onClick"],E={class:"text-2xl"},M={class:"float-right flex space-x-3"},P={class:"border-r-2 pr-2 pt-1"};function U(t,s,r,_,h,u){const c=p("FeatherIcon"),i=p("Dropdown"),n=p("Avatar");return d(),k("div",D,[e("div",F,[t.$currentPage.get()=="Tickets"?(d(),k("div",I,[o(i,{placement:"left",options:u.ticketFilterDropdownOptions()},{default:l(({toggleDropdown:a})=>[e("div",{class:"flex items-center",onClick:a},[e("div",N,f(this.$ticketFilter.get()),1),o(c,{class:"ml-2 stroke-slate-600 h-5 w-5",name:"chevron-down"})],8,j)]),_:1},8,["options"])])):t.$currentPage.get()=="Contacts"?(d(),k("div",O,[o(i,{placement:"left",options:u.contactFilterDropdownOptions()},{default:l(({toggleDropdown:a})=>[e("div",{class:"flex items-center",onClick:a},[e("div",E,f(this.$contactFilter.get()),1),o(c,{class:"ml-2 stroke-slate-600 h-5 w-5",name:"chevron-down"})],8,W)]),_:1},8,["options"])])):$("",!0)]),e("div",M,[e("div",P,[o(c,{class:"w-5 h-5",name:"bell"})]),t.$tickets().get("types")?(d(),m(i,{key:0,options:u.getAvatarClickOptions()},{default:l(({toggleAssignees:a})=>[t.$user.get()?(d(),m(n,{key:0,class:"cursor-pointer",imageURL:t.$user.get().profile_image},null,8,["imageURL"])):$("",!0)]),_:1},8,["options"])):$("",!0)])])}var L=g(B,[["render",U]]);const R={name:"SideBarMenu",inject:["viewportWidth"],props:["selectedMenuItem"],data(){return{iconHeight:30,iconWidth:30}},components:{CustomIcons:w}},V={class:"space-y-5 mb-auto"},K={class:"group p-1 rounded-md pb-5"},z={class:"group p-3 hover:bg-blue-50 rounded-md cursor-pointer"},G={class:"group p-3 hover:bg-blue-50 rounded-md cursor-pointer"},H={class:"group p-3 hover:bg-blue-50 rounded-md cursor-pointer"},q={class:"group p-3 hover:bg-blue-50 rounded-md cursor-pointer"},J={class:"space-y-5 mt-auto mb-2"},Q={class:"group p-3 hover:bg-blue-50 rounded-md cursor-pointer"};function X(t,s,r,_,h,u){const c=p("CustomIcons"),i=p("router-link");return d(),k("div",{class:"flex flex-col px-1 border-r pt-4",style:S({height:u.viewportWidth>768?"calc(100vh)":null})},[e("div",V,[e("div",K,[o(c,{name:"helpdesk",width:"40",height:"40"})]),e("div",null,[o(i,{to:"/helpdesk/tickets"},{default:l(()=>[e("div",z,[o(c,{name:"ticket",class:"group-hover:stroke-blue-600",width:"25",height:"25"})])]),_:1})]),e("div",null,[o(i,{to:"/helpdesk/knowledge-base"},{default:l(()=>[e("div",G,[o(c,{name:"knowledge-base",class:"group-hover:stroke-blue-600",width:"25",height:"25"})])]),_:1})]),e("div",null,[o(i,{to:"/helpdesk/contacts"},{default:l(()=>[e("div",H,[o(c,{name:"customers",class:"group-hover:stroke-blue-600",width:"25",height:"25"})])]),_:1})]),e("div",null,[o(i,{to:"/helpdesk/reports"},{default:l(()=>[e("div",q,[o(c,{name:"reports",class:"group-hover:stroke-blue-600",width:"25",height:"25"})])]),_:1})])]),e("div",J,[e("div",null,[o(i,{to:"/helpdesk/settings"},{default:l(()=>[e("div",Q,[o(c,{name:"settings",class:"group-hover:stroke-blue-600",width:"25",height:"25"})])]),_:1})])])],4)}var Y=g(R,[["render",X]]);const Z={name:"Desk",data(){return{viewportWidth:0}},resources:{user(){return{method:"helpdesk.api.agent.get_user",onSuccess:()=>{this.$user.set(this.$resources.user.data),this.$resources.tickets.fetch()},onFailure:()=>{window.location.replace("/login")}}},tickets(){return{method:"helpdesk.api.ticket.get_tickets",onSuccess:()=>{this.$tickets().set({tickets:this.$resources.tickets.data})}}},ticket(){return{method:"helpdesk.api.ticket.get_ticket",onSuccess:()=>{this.$tickets(this.$resources.ticket.data.name).set(this.$resources.ticket.data)}}},createTicket(){return{method:"helpdesk.api.ticket.create_new",onSuccess:()=>{this.$tickets().update(),window.location.reload()}}},updateTicketContact(){return{method:"helpdesk.api.ticket.update_contact",onSuccess:t=>{window.location.reload()}}},types(){return{method:"frappe.client.get_list",params:{doctype:"Ticket Type"},auto:!0,onSuccess:()=>{this.$tickets().set({types:this.$resources.types.data})}}},priorities(){return{method:"frappe.client.get_list",params:{doctype:"Ticket Priority"},auto:!0,onSuccess:()=>{this.$tickets().set({priorities:this.$resources.priorities.data})}}},contacts(){return{method:"frappe.client.get_list",params:{doctype:"Contact"},auto:!0,onSuccess:()=>{this.$tickets().set({contacts:this.$resources.contacts.data})}}},statuses(){return{method:"helpdesk.api.ticket.get_all_ticket_statuses",auto:!0,onSuccess:()=>{this.$tickets().set({statuses:this.$resources.statuses.data})}}},agents(){return{method:"frappe.client.get_list",params:{doctype:"Agent",fields:["*"]},auto:!0,onSuccess:()=>{this.$agents.set(this.$resources.agents.data)}}},assignTicketToAgent(){return{method:"helpdesk.api.ticket.assign_ticket_to_agent",onSuccess:t=>{this.$tickets(t.name).update()}}},assignTicketType(){return{method:"helpdesk.api.ticket.assign_ticket_type",onSuccess:t=>{this.$tickets(t.name).update(),this.$resources.types.fetch()}}},assignTicketStatus(){return{method:"helpdesk.api.ticket.assign_ticket_status",onSuccess:t=>{this.$tickets(t.name).update()}}},assignTicketPriority(){return{method:"helpdesk.api.ticket.assign_ticket_priority",onSuccess:t=>{this.$tickets(t.name).update()}}},createTicketType(){return{method:"helpdesk.api.ticket.check_and_create_ticket_type",onSuccess:t=>{this.$resources.types.fetch()}}}},provide:{viewportWidth:Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)},components:{NavBar:L,SideBarMenu:Y},created(){const t=Object.fromEntries(document.cookie.split("; ").map(r=>r.split("=")).map(r=>[r[0],decodeURIComponent(r[1])]));t.user_id&&t.user_id!=="Guest"?this.$resources.user.fetch():window.location.replace("/login")},mounted(){this.$tickets().setUpdateTickets(()=>{this.$resources.tickets.fetch()}),this.$tickets().setUpdateTicket(t=>{this.$resources.ticket.fetch({ticket_id:t})}),this.$tickets().setCreateTicket(t=>{this.$resources.createTicket.submit({subject:t.subject,description:t.description})}),this.$tickets().setAssignAgent((t,s)=>{this.$resources.assignTicketToAgent.submit({ticket_id:t,agent_id:s})}),this.$tickets().setAssignType((t,s)=>{this.$resources.assignTicketType.submit({ticket_id:t,type:s})}),this.$tickets().setAssignStatus((t,s)=>{this.$resources.assignTicketStatus.submit({ticket_id:t,status:s})}),this.$tickets().setAssignPriority((t,s)=>{this.$resources.assignTicketPriority.submit({ticket_id:t,priority:s})}),this.$tickets().setCreateType(t=>{this.$resources.createTicketType.submit({type:t})}),this.$tickets().setUpdateContact((t,s)=>{this.$resources.updateTicketContact.submit({ticket_id:t,contact:s})}),this.$socket.on("list_update",t=>{t.doctype=="Ticket"&&this.$tickets(t.name).update()})},mounted(){console.log("desk mounted!!")}},tt={class:"w-screen flex"},et={class:"w-15"},st={class:"flex-col w-full"},ot={class:"h-15"};function it(t,s,r,_,h,u){const c=p("SideBarMenu"),i=p("NavBar"),n=p("router-view");return d(),k("div",tt,[e("div",et,[o(c)]),e("div",st,[e("div",ot,[o(i)]),e("div",null,[o(n,null,{default:l(({Component:a})=>[(d(),m(x,null,[(d(),m(A(a)))],1024))]),_:1})])])])}var at=g(Z,[["render",it]]);export{at as default};
