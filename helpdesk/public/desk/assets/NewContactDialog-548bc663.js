import{_ as g,p as m,M as C,I as _,D as N,o as y,d as v,i,w as E,b as r,k as x,v as I,r as c}from"./index-d9377e3a.js";import{E as b}from"./ErrorMessage-e4ff6432.js";import{A as k}from"./Autocomplete-c752a27e.js";const D={name:"NewContactDialog",props:{modelValue:{type:Boolean,required:!0},fdCustomer:{type:String,default:null}},setup(e,{emit:t}){const d=m(""),a=m(""),s=m(""),u=m(""),n=m(""),l=m(""),h=I("contacts");return{open:C({get:()=>e.modelValue,set:p=>{t("update:modelValue",p),p||t("close")}}),contacts:h,emailValidationError:d,firstNameValidationError:a,lastNameValidationError:s,phoneValidationError:u,customerValidationError:n,selectedCustomer:l}},data(e){return{firstName:"",lastName:"",emailId:"",phone:"",customer:""}},watch:{emailId(e){this.validateEmailInput(e)},firstName(e){this.validateFirstName(e)},phone(e){this.validatePhone(e)},customer(e){this.validateCustomer(e)}},resources:{createContact(){return{url:"frappe.client.insert",onSuccess:e=>{this.emailId="",this.firstName="",this.lastName="",this.phone="",this.customer="",this.$emit("contactCreated",e)}}},getCustomers(){return{url:"frappedesk.extends.client.get_list",params:{doctype:"HD Customer",fields:["name","customer_name"]},auto:!0}}},components:{Input:_,Dialog:N,ErrorMessage:b,Autocomplete:k},methods:{createContact(){if(this.validateInputs())return;let e={doctype:"Contact",first_name:this.firstName,last_name:this.lastName,email_ids:[{email_id:this.emailId,is_primary:!0}],links:[{link_doctype:"HD Customer",link_name:this.fdCustomer!=null?this.fdCustomer:this.selectedCustomer}]};this.phone&&(e.phone_nos=[{phone:this.phone}]),this.$resources.createContact.submit({doc:e})},validateInputs(){let e=this.validateEmailInput(this.emailId);return e+=this.validateFirstName(this.firstName),e+=this.validatePhone(this.phone),e},validateEmailInput(e){function t(a){let s=[];for(let u in a)s.push(a[u].email_id);return s}return this.emailValidationError="",e?/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,24}))$/.test(e)?t(this.contacts).includes(e)&&(this.emailValidationError="Contact with email already exists"):this.emailValidationError="Enter a valid email":this.emailValidationError="Email should not be empty",this.emailValidationError},validateFirstName(e){return this.firstNameValidationError="",e?e.trim()==""&&(this.firstNameValidationError="First name should not be empty"):this.firstNameValidationError="First name should not be empty",this.firstNameValidationError},validatePhone(e){return this.phoneValidationError="",e?(!/[0-9]+/.test(e)||e.length<10)&&(this.phoneValidationError="Enter a valid phone number"):this.phoneValidationError="",this.phoneValidationError},validateCustomer(e){return this.customerValidationError="",e?e.trim()==""&&(this.customerValidationError="Customer should not be empty"):this.customerValidationError="Customer should not be empty",this.customerValidationError}}},w={class:"space-y-4"},A={class:"space-y-1"},B={class:"space-y-1"},F={class:"space-y-1"},M={class:"space-y-1"},U={class:"w-full space-y-1"},P=r("div",null,[r("span",{class:"block mb-2 text-sm leading-4 text-gray-700"}," Customer ")],-1),H={class:"flex float-right space-x-2"};function z(e,t,d,a,s,u){const n=c("Input"),l=c("ErrorMessage"),h=c("Autocomplete"),f=c("Button"),p=c("Dialog");return y(),v("div",null,[i(p,{options:{title:"Create New Contact"},modelValue:a.open,"onUpdate:modelValue":t[6]||(t[6]=o=>a.open=o)},{"body-content":E(()=>[r("div",w,[r("div",A,[i(n,{label:"Email Id",type:"email",modelValue:s.emailId,"onUpdate:modelValue":t[0]||(t[0]=o=>s.emailId=o)},null,8,["modelValue"]),i(l,{message:a.emailValidationError},null,8,["message"])]),r("div",B,[i(n,{label:"First Name",type:"text",modelValue:s.firstName,"onUpdate:modelValue":t[1]||(t[1]=o=>s.firstName=o)},null,8,["modelValue"]),i(l,{message:a.firstNameValidationError},null,8,["message"])]),r("div",F,[i(n,{label:"Last Name (optional)",type:"text",modelValue:s.lastName,"onUpdate:modelValue":t[2]||(t[2]=o=>s.lastName=o)},null,8,["modelValue"]),i(l,{message:a.lastNameValidationError},null,8,["message"])]),r("div",M,[i(n,{label:"Phone (optional)",type:"text",modelValue:s.phone,"onUpdate:modelValue":t[3]||(t[3]=o=>s.phone=o)},null,8,["modelValue"]),i(l,{message:a.phoneValidationError},null,8,["message"])]),r("div",U,[P,i(h,{value:d.fdCustomer!=null?d.fdCustomer:a.selectedCustomer,onChange:t[4]||(t[4]=o=>{o&&(a.selectedCustomer=o.value)}),resourceOptions:{url:"frappedesk.extends.client.get_list",inputMap:o=>({doctype:"HD Customer",pluck:"name",filters:[["name","like",`%${o}%`]]}),responseMap:o=>o.map(V=>({label:V.name,value:V.name}))}},null,8,["value","resourceOptions"]),i(l,{message:a.customerValidationError},null,8,["message"])]),r("div",H,[i(f,{loading:this.$resources.createContact.loading,appearance:"primary",onClick:t[5]||(t[5]=o=>u.createContact())},{default:E(()=>[x("Create")]),_:1},8,["loading"])])])]),_:1},8,["modelValue"])])}const j=g(D,[["render",z]]);export{j as N};
