import{A as y}from"./Autocomplete-c752a27e.js";import{_ as h,o,d as c,b as a,t as f,c as k,h as b,r as d,I as v,s as I,p as u,F as T,e as w,i as g,w as C,k as F,m as _}from"./index-d9377e3a.js";const M={name:"TicketField",props:{ticketId:{type:Number,required:!0},fieldname:{type:String,required:!0},editable:{type:Boolean,default:!0},validate:{type:Function,default:function(){return!0}},triggerValidationError:{type:Boolean,default:!1}},components:{Autocomplete:y},computed:{ticket(){return this.$resources.ticket.doc||null},fieldMetaInfo(){return this.$resources.fieldMetaInfo.data||null},fieldValue(){return this.fieldname=="_assign"?this.$resources.getAssignee.data?.agent_name||null:this.ticket?.[this.fieldname]||null}},mounted(){this.fieldname=="_assign"&&this.$socket.on("ticket_assignee_update",e=>{e.ticket_id==this.ticket.name&&this.$resources.getAssignee.fetch()})},resources:{ticket(){return{type:"document",doctype:"HD Ticket",name:this.ticketId,setValue:{onSuccess(){this.$toast({title:"Ticket updated successfully.",icon:"check",iconClasses:"text-green-500"})},onError(e){this.$toast({title:"Error while updating ticket",text:e,icon:"x",iconClasses:"text-red-500"})}}}},fieldMetaInfo(){return{url:"frappedesk.api.ticket.get_field_meta_info",params:{fieldname:this.fieldname},auto:!0}},getAssignee(){if(this.fieldname==="_assign")return{url:"frappedesk.api.ticket.get_assignee",params:{ticket_id:this.ticketId},auto:!0}},setTicketAssignee(){return{url:"frappedesk.api.ticket.assign_ticket_to_agent",onSuccess:()=>{this.$toast({title:"Agent assigned successfully",icon:"check",iconClasses:"text-green-500"})},onError:e=>{this.$toast({title:"Error while assigning agent",text:e,icon:"x",iconClasses:"text-red-500"})}}}},methods:{onInput(e){if(this.validate())if(this.fieldname=="_assign")this.$resources.setTicketAssignee.submit({ticket_id:this.ticketId,agent_id:e});else{let t={};t[this.fieldname]=e,this.$resources.ticket.setValue.submit(t)}else this.$toast({title:"Please fill all mandatory fields.",icon:"x",iconClasses:"text-red-500"})},getResourceOptions(){if(this.editable||this.fieldMetaInfo)switch(this.fieldMetaInfo?.fieldtype){case"Link":let e=[];return this.fieldname=="_assign"&&(e.push(["HD Agent","is_active","=",1]),this.ticket.agent_group&&e.push(["Agent Group Item","agent_group","=",this.ticket.agent_group])),{url:"frappedesk.extends.client.get_list",inputMap:t=>{const s=[...e,["name","like",`%${t}%`]];return{doctype:this.fieldMetaInfo?.options,pluck:"name",filters:s}},responseMap:t=>t.map(s=>({label:s.name,value:s.name}))};case"Select":return{url:"frappedesk.api.general.get_filtered_select_field_options",inputMap:t=>({doctype:"HD Ticket",fieldname:this.fieldMetaInfo?.fieldname,query:t}),responseMap:t=>t.map(s=>({label:s,value:s}))};default:return null}}}},A={class:"flex flex-col space-y-[8px]"},V={class:"text-[12px] text-gray-600"};function B(e,t,s,i,x,n){const m=d("Input"),p=d("Autocomplete");return o(),c("div",A,[a("div",V,f(n.fieldMetaInfo?.label),1),a("div",null,[n.fieldMetaInfo?.fieldtype==="Data"?(o(),k(m,{key:0,type:"text",onChange:t[0]||(t[0]=l=>{n.onInput(l)}),value:n.fieldValue,debounce:300,disabled:!s.editable},null,8,["value","disabled"])):(o(),k(p,{key:1,placeholder:`Select ${n.fieldMetaInfo?.label.toLowerCase()}`,class:b(["rounded-md",{"border-red-500 border":s.triggerValidationError}]),value:n.fieldValue,onChange:t[1]||(t[1]=l=>{n.onInput(l?.value)}),resourceOptions:n.getResourceOptions(),searchable:s.editable},null,8,["placeholder","class","value","resourceOptions","searchable"]))])])}const j=h(M,[["render",B]]),H={name:"CustomerSatiscationFeedback",props:["ticket","editable","fromDesk"],components:{Input:v,FeatherIcon:I},setup(){const e=u(0),t=u(""),s=u(!1);return{ratingHovered:u(0),satisfactionRating:e,feedbackText:t,submitted:s}},resources:{submitFeedback(){return{url:"frappedesk.api.ticket.submit_customer_feedback",onSuccess(){this.submitted=!0}}}},computed:{ratingToText(){const e=this.submitted?this.ticket.satisfaction_rating:this.ratingHovered||this.satisfactionRating;return e==0?"":e<.4?"Very Bad":e<.6?"Bad":e<.8?"Average":e<1?"Good":"Very Good"}},mounted(){this.submitted=this.ticket.feedback_submitted}},R={class:"p-[10px] rounded-[6px] text-gray-900 bg-white shadow-sm border flex flex-col space-y-[8px]"},S={class:"flex flex-row items-center"},D={class:"text-[14px] font-medium"},E={class:"ml-[25px] flex flex-row items-center space-x-[20px] font-normal text-base"},N={class:"text-sm text-gray-600"},O={key:0,class:"flex flex-col space-y-[8px]"},P={key:1,class:"flex flex-col space-y-[8px] text-[12px] font-normal text-gray-700"},G={class:"flex flex-col space-y-[2px]"},L={class:"italic"};function q(e,t,s,i,x,n){const m=d("FeatherIcon"),p=d("Input"),l=d("Button");return o(),c("div",R,[a("div",S,[a("div",D,f(i.submitted?s.fromDesk?"Rating":"You Rated":"How did we do?"),1),a("div",E,[a("div",{class:"flex flex-row space-x-2",onPointerleave:t[0]||(t[0]=()=>{i.ratingHovered=0})},[(o(),c(T,null,w([1,2,3,4,5],r=>a("div",{key:r},[g(m,{name:"star",class:b(["w-5 h-5 stroke-gray-500",`
								${(i.ratingHovered||i.satisfactionRating||s.ticket.satisfaction_rating)>=r*.2?"fill-yellow-500":"fill-gray-200"} 
								${i.submitted?"cursor-default":"cursor-pointer"}
							`]),onPointerenter:()=>{i.submitted||(i.ratingHovered=r*.2)},onClick:()=>{i.submitted||(i.satisfactionRating=r*.2)}},null,8,["class","onPointerenter","onClick"])])),64))],32),a("div",N,f(n.ratingToText),1)])]),!i.submitted&&i.satisfactionRating!=0?(o(),c("div",O,[g(p,{type:"textarea",class:"focus:bg-white bg-white border border-gray-200 rounded focus:border-gray-400",value:i.feedbackText,onInput:t[1]||(t[1]=r=>{i.feedbackText=r}),placeholder:"Tell us about your experience."},null,8,["value"]),a("div",null,[g(l,{appearance:"primary",loading:e.$resources.submitFeedback.loading,onClick:t[2]||(t[2]=r=>e.$resources.submitFeedback.submit({ticket_id:s.ticket.name,satisfaction_rating:this.satisfactionRating,feedback_text:this.feedbackText}))},{default:C(()=>[F(" Submit my review ")]),_:1},8,["loading"])])])):_("",!0),i.submitted&&(s.ticket.customer_feedback||i.feedbackText)?(o(),c("div",P,[a("div",G,[a("div",L,' "'+f(s.ticket.customer_feedback||i.feedbackText)+'" ',1)])])):_("",!0)])}const J=h(H,[["render",q]]);export{J as C,j as T};
